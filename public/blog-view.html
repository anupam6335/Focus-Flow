<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog - FocusFlow</title>
    <link rel="icon" type="image/x-icon" href="/assets/FocusFlow.ico" />
    <link rel="stylesheet" href="/css/theme.css" />

    <!-- Markdown Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.7/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css"
    />
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <link rel="stylesheet" href="/css/blog-view.css" />
    <link rel="stylesheet" href="/css/blog-view-comment.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-container">
          <h1 class="site-logo">FocusFlow</h1>
          <div class="nav-links">
            <a id="back-to-blogs" class="nav-link">‚Üê Back to Blogs</a>
            <a href="/profile" class="nav-link profile-link">üë§ Profile</a>
            <a id="tracker-link" class="nav-link">Tracker</a>
          </div>
        </div>
      </header>

      <div class="main-content">
        <div class="blog-content-area">
          <!-- Mini-map Navigation - NOW DRAGGABLE -->
          <div class="mini-map-container" id="miniMap">
            <div class="mini-map-header">
              <h4 class="mini-map-title">Mini Map</h4>
              <button
                class="mini-map-toggle"
                id="miniMapToggle"
                title="Toggle mini-map"
              >
                ‚àí
              </button>
            </div>
            <div class="mini-map-content" id="miniMapContent">
              <div class="mini-map-progress" id="miniMapProgress"></div>
              <!-- Mini-map items will be generated here -->
            </div>
          </div>

          <div id="blogContent">
            <div class="loading" id="loading">
              <h3>Loading blog...</h3>
            </div>

            <div id="errorMessage" class="error-message" style="display: none">
              <h3>Blog not found</h3>
              <p>
                The blog you're looking for doesn't exist or you don't have
                permission to view it.
              </p>
              <a
                href="https://focus-flow-lopn.onrender.com/blogs"
                class="btn btn-primary"
                style="margin-top: 15px"
                >Back to Blogs</a
              >
            </div>

            <article
              id="blogArticle"
              class="blog-article"
              style="display: none"
            >
              <div class="blog-header">
                <div class="blog-title-section">
                  <h1 class="blog-title" id="blogTitle"></h1>
                  <div class="blog-header-actions" id="blogHeaderActions"></div>
                </div>
                <div class="blog-meta">
                  <div class="blog-author" id="blogAuthor"></div>
                  <div class="blog-date" id="blogDate"></div>
                  <div class="blog-views" id="blogViews"></div>
                  <div class="blog-visibility" id="blogVisibility"></div>
                </div>
                <div class="blog-tags" id="blogTags"></div>
              </div>

              <div class="blog-content" id="blogContentText"></div>

              <!-- comment section will be here -->
              <!--after the blog content section -->
              <section class="comments-section" id="commentsSection">
                <div class="comments-header">
                  <h2 class="comments-title">Community Discussion</h2>
                  <div class="comments-stats">
                    <span class="comments-count">0 Comments</span>
                  </div>
                </div>

                <!-- Comment Sorting Tabs -->
                <div class="comments-sorting">
                  <button class="sort-tab active" data-sort="newest">
                    Newest Comments
                  </button>
                  <button class="sort-tab" data-sort="oldest">
                    Oldest Comments
                  </button>
                  <button class="sort-tab" data-sort="popular">
                    Popular Comments
                  </button>
                </div>

                <!-- Comment Input Area -->
                <div class="comment-input-container">
                  <div class="user-avatar">
                    <div class="avatar-placeholder">üë§</div>
                  </div>
                  <div class="input-wrapper">
                    <textarea
                      class="comment-input"
                      placeholder="Join the conversation..."
                      rows="3"
                    ></textarea>
                    <div class="input-actions">
                      <button class="btn btn-primary submit-comment">
                        Post Comment
                      </button>
                    </div>
                  </div>
                </div>

                <!--after the Comment Input Area in blog-view.html -->
                <div
                  class="guest-comment-message"
                  id="guestCommentMessage"
                  style="display: none"
                >
                  <div class="guest-message-content">
                    <div class="guest-icon">üí¨</div>
                    <div class="guest-text">
                      <p>
                        You can also share your thoughts ‚Äî please log in to join
                        the discussion.
                      </p>
                      <button
                        class="btn btn-primary login-btn"
                        onclick="redirectToLogin()"
                      >
                        Login
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Comments Container -->
                <div class="comments-container" id="commentsContainer">
                  <!-- Comments will be dynamically inserted here -->
                  <div class="empty-state">
                    <div class="empty-icon">üí¨</div>
                    <h3>No comments yet</h3>
                    <p>Be the first to share your thoughts!</p>
                  </div>
                </div>
              </section>

              <div class="blog-actions" id="blogActions">
                <a href="https://focus-flow-lopn.onrender.com/blogs" class="btn btn-secondary"
                  >‚Üê Back to Blogs</a
                >
              </div>
            </article>

            <div
              class="inline-editor-container"
              id="inlineEditorContainer"
              style="display: none"
            >
              <div class="inline-editor" id="inlineEditor">
                <div class="inline-editor-header">
                  <h3 class="inline-editor-title">Edit Blog</h3>
                  <div class="inline-editor-actions">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      onclick="cancelInlineEdit()"
                    >
                      Cancel
                    </button>
                    <button
                      type="button"
                      class="btn btn-primary"
                      onclick="saveInlineEdit()"
                    >
                      Save Changes
                    </button>
                  </div>
                </div>

                <form id="inlineEditForm" class="inline-edit-form">
                  <div class="form-group">
                    <label class="form-label" for="inlineEditTitle"
                      >Title</label
                    >
                    <input
                      type="text"
                      id="inlineEditTitle"
                      class="form-input"
                      required
                    />
                  </div>

                  <div class="form-group">
                    <label class="form-label" for="inlineEditContent"
                      >Content (Markdown supported)</label
                    >
                    <textarea
                      id="inlineEditContent"
                      class="form-textarea"
                      required
                      rows="20"
                    ></textarea>
                    <div class="markdown-help">
                      Supports Markdown: **bold**, *italic*, `code`, # headers,
                      - lists
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label" for="inlineEditTags"
                      >Tags (comma separated)</label
                    >
                    <input
                      type="text"
                      id="inlineEditTags"
                      class="form-input"
                      placeholder="coding, algorithms, tips"
                    />
                  </div>

                  <div class="form-group">
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        id="inlineEditIsPublic"
                        class="form-checkbox"
                      />
                      Make this blog public
                    </label>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Sidebar -->
        <div class="right-sidebar">
          <!-- Popular Blogs Section -->
          <div class="sidebar-section">
            <h3 class="sidebar-title">Popular Blogs</h3>
            <div class="popular-blogs-list" id="popularBlogsList">
              <div class="popular-blog-item">
                <div class="popular-blog-title">Loading popular blogs...</div>
                <div class="popular-blog-meta">
                  <span>By Author</span>
                  <span>üëÅÔ∏è 0 views</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--HTML for the confirmation popup (place before closing body tag) -->
    <div class="confirmation-overlay" id="confirmationOverlay">
      <div class="confirmation-popup">
        <div class="confirmation-icon">‚ö†Ô∏è</div>
        <h3 class="confirmation-title">Delete Blog</h3>
        <p class="confirmation-message" id="confirmationMessage">
          Are you sure you want to delete this blog? This action cannot be
          undone.
        </p>
        <div class="confirmation-actions">
          <button
            class="confirmation-btn confirmation-btn-cancel"
            id="confirmationCancel"
          >
            Cancel
          </button>
          <button
            class="confirmation-btn confirmation-btn-confirm"
            id="confirmationConfirm"
          >
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="/js/blog-view.js" type="text/javascript"></script>

    <!-- Scroll to Top Button -->
    <button class="scroll-to-top" id="scrollToTop" aria-label="Scroll to top">
      ‚Üë
    </button>
  </body>
</html>
