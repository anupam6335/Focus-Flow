<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/FocusFlow.ico" />
    <link rel="stylesheet" href="/responsive.css" />
    <title>User Profile - FocusFlow</title>
    <style>
      /* Reuse all the same styles from profile.html */

      /* CodeLeaf Theme Variables - Consistent with existing system */
      :root {
        --codeleaf-bg-primary: #f8fbf8;
        --codeleaf-bg-secondary: #f1f8f1;
        --codeleaf-bg-tertiary: #eaf5ea;
        --codeleaf-text-primary: #1a3a1a;
        --codeleaf-text-secondary: #4a674a;
        --codeleaf-text-tertiary: #6b856b;
        --codeleaf-accent-primary: #2d7a2d;
        --codeleaf-accent-secondary: #4ca64c;
        --codeleaf-accent-muted: #a8d4a8;
        --codeleaf-border-light: #e0ede0;
        --codeleaf-border-medium: #c8e0c8;
        --codeleaf-success: #2d7a2d;
        --codeleaf-warning: #b38f2d;
        --codeleaf-error: #c44545;
        --codeleaf-info: #2d6b7a;

        /* Fluid Typography */
        --codeleaf-font-xs: clamp(0.7rem, 2vw, 0.75rem);
        --codeleaf-font-sm: clamp(0.8rem, 2.5vw, 0.875rem);
        --codeleaf-font-base: clamp(0.9rem, 3vw, 1rem);
        --codeleaf-font-lg: clamp(1rem, 3.5vw, 1.125rem);
        --codeleaf-font-xl: clamp(1.125rem, 4vw, 1.25rem);
        --codeleaf-font-2xl: clamp(1.25rem, 5vw, 1.5rem);
        --codeleaf-font-3xl: clamp(1.5rem, 6vw, 1.875rem);

        /* Fluid Spacing */
        --codeleaf-space-1: clamp(0.125rem, 1vw, 0.25rem);
        --codeleaf-space-2: clamp(0.25rem, 1.5vw, 0.5rem);
        --codeleaf-space-3: clamp(0.375rem, 2vw, 0.75rem);
        --codeleaf-space-4: clamp(0.5rem, 2.5vw, 1rem);
        --codeleaf-space-6: clamp(0.75rem, 3vw, 1.5rem);
        --codeleaf-space-8: clamp(1rem, 4vw, 2rem);

        /* Border Radius */
        --codeleaf-radius-sm: 4px;
        --codeleaf-radius-md: 6px;
        --codeleaf-radius-lg: 8px;

        /* Shadows */
        --codeleaf-shadow-sm: 0 1px 2px rgba(45, 122, 45, 0.04);
        --codeleaf-shadow-md: 0 2px 8px rgba(45, 122, 45, 0.08);
        --codeleaf-shadow-lg: 0 4px 16px rgba(45, 122, 45, 0.12);
      }

      /* Dark mode support */
      @media (prefers-color-scheme: dark) {
        :root {
          --codeleaf-bg-primary: #0a1a0a;
          --codeleaf-bg-secondary: #0f230f;
          --codeleaf-bg-tertiary: #142d14;
          --codeleaf-text-primary: #e8f5e8;
          --codeleaf-text-secondary: #b8d4b8;
          --codeleaf-text-tertiary: #88a488;
          --codeleaf-accent-primary: #4ca64c;
          --codeleaf-accent-secondary: #5cb85c;
          --codeleaf-accent-muted: #2d5a2d;
          --codeleaf-border-light: #1a3a1a;
          --codeleaf-border-medium: #2d4a2d;
        }
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
      }

      body {
        background-color: var(--codeleaf-bg-primary);
        color: var(--codeleaf-text-primary);
        line-height: 1.6;
        padding: var(--codeleaf-space-4);
        transition: background-color 0.3s, color 0.3s;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      /* Header Styles - Consistent with existing pages */
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--codeleaf-space-6);
        padding-bottom: var(--codeleaf-space-4);
        border-bottom: 1px solid var(--codeleaf-border-light);
      }

      h1 {
        font-size: var(--codeleaf-font-2xl);
        color: var(--codeleaf-accent-primary);
        font-weight: 700;
      }

      .nav-links {
        display: flex;
        gap: var(--codeleaf-space-4);
        align-items: center;
      }

      .nav-link {
        color: var(--codeleaf-text-secondary);
        text-decoration: none;
        padding: var(--codeleaf-space-2) var(--codeleaf-space-4);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.2s ease;
        border: 1px solid var(--codeleaf-border-light);
        background: var(--codeleaf-bg-primary);
        font-size: var(--codeleaf-font-sm);
      }

      .nav-link:hover {
        background: var(--codeleaf-bg-tertiary);
        border-color: var(--codeleaf-accent-muted);
        color: var(--codeleaf-accent-primary);
        transform: translateY(-1px);
      }

      .nav-link.active {
        background: var(--codeleaf-accent-primary);
        color: white;
        border-color: var(--codeleaf-accent-primary);
      }

      /* Main Layout - 70/30 split like index.html */
      .main-container {
        display: flex;
        gap: var(--codeleaf-space-8);
        align-items: flex-start;
      }

      .left-column {
        flex: 0 0 70%;
        width: 70%;
      }

      .right-column {
        flex: 0 0 30%;
        width: 30%;
        display: flex;
        flex-direction: column;
        gap: var(--codeleaf-space-6);
      }

      /* Profile Header Section */
      .profile-header {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        margin-bottom: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
        display: flex;
        gap: var(--codeleaf-space-6);
        align-items: center;
      }

      .avatar-container {
        position: relative;
        flex-shrink: 0;
      }

      .pixel-avatar {
        width: 120px;
        height: 120px;
        border-radius: var(--codeleaf-radius-lg);
        background: linear-gradient(
          135deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: white;
        box-shadow: var(--codeleaf-shadow-md);
        border: 4px solid var(--codeleaf-bg-primary);
        outline: 1px solid var(--codeleaf-border-light);
      }

      .profile-info {
        flex: 1;
      }

      .profile-name {
        font-size: var(--codeleaf-font-2xl);
        color: var(--codeleaf-accent-primary);
        margin-bottom: var(--codeleaf-space-2);
        font-weight: 700;
      }

      .profile-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: var(--codeleaf-space-4);
        margin-top: var(--codeleaf-space-4);
      }

      .stat-item {
        text-align: center;
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-secondary);
        border-radius: var(--codeleaf-radius-md);
        border: 1px solid var(--codeleaf-border-light);
      }

      .stat-value {
        font-size: var(--codeleaf-font-xl);
        font-weight: 700;
        color: var(--codeleaf-accent-primary);
        margin-bottom: var(--codeleaf-space-1);
      }

      .stat-label {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Achievements Section */
      .achievements-section {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        margin-bottom: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .section-title {
        font-size: var(--codeleaf-font-xl);
        color: var(--codeleaf-accent-primary);
        margin-bottom: var(--codeleaf-space-4);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-2);
      }

      /* Enhanced Achievements Section */
      .achievements-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: var(--codeleaf-space-3);
      }

      .achievement-card {
        background: var(--codeleaf-bg-secondary);
        border: 2px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-3);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        text-align: center;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: var(--codeleaf-space-2);
      }

      /* Subtle unlocked state */
      .achievement-card.unlocked {
        background: var(--codeleaf-bg-primary);
        border-color: var(--codeleaf-accent-muted);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      /* Locked state - more subtle */
      .achievement-card:not(.unlocked) {
        background: var(--codeleaf-bg-secondary);
        border-color: var(--codeleaf-border-light);
        opacity: 0.7;
      }

      .achievement-card:not(.unlocked):hover {
        opacity: 0.9;
        transform: translateY(-2px);
      }

      .achievement-card.unlocked:hover {
        border-color: var(--codeleaf-accent-primary);
        transform: translateY(-2px);
        box-shadow: var(--codeleaf-shadow-md);
      }

      .achievement-icon {
        font-size: 2rem;
        margin-bottom: 0;
        transition: transform 0.3s ease;
      }

      .achievement-card:hover .achievement-icon {
        transform: scale(1.1);
      }

      .achievement-title {
        font-weight: 600;
        color: var(--codeleaf-text-primary);
        margin-bottom: 0;
        font-size: var(--codeleaf-font-sm);
        line-height: 1.2;
      }

      .achievement-card:not(.unlocked) .achievement-title {
        color: var(--codeleaf-text-tertiary);
      }

      .achievement-desc {
        display: none; /* Hide description by default */
      }

      .achievement-progress {
        margin-top: var(--codeleaf-space-2);
        height: 4px;
        background: var(--codeleaf-border-light);
        border-radius: 2px;
        overflow: hidden;
        width: 100%;
      }

      .achievement-progress-bar {
        height: 100%;
        background: var(--codeleaf-accent-primary);
        border-radius: 2px;
        transition: width 0.3s ease;
      }

      /* Grayscale effect for locked achievements */
      .achievement-card:not(.unlocked) {
        filter: grayscale(0.9) brightness(0.95);
        background: var(--codeleaf-bg-secondary);
        border-color: var(--codeleaf-border-light);
        opacity: 0.8;
      }

      .achievement-card:not(.unlocked):hover {
        filter: grayscale(0.7) brightness(1);
        opacity: 0.9;
        transform: translateY(-2px);
      }

      .achievement-card:not(.unlocked) .achievement-icon {
        filter: grayscale(1) brightness(0.8);
      }

      .achievement-card:not(.unlocked):hover .achievement-icon {
        filter: grayscale(0.6) brightness(0.9);
      }

      .achievement-card:not(.unlocked) .achievement-title {
        color: var(--codeleaf-text-tertiary);
      }

      /* Tooltip for achievements */
      .achievement-tooltip {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(-8px);
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-3);
        box-shadow: var(--codeleaf-shadow-lg);
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
        white-space: nowrap;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: none;
      }

      .achievement-tooltip::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: var(--codeleaf-bg-primary);
      }

      .achievement-card:hover .achievement-tooltip {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(-12px);
      }

      /* Lock icon for locked achievements */
      .achievement-lock {
        position: absolute;
        top: 8px;
        right: 8px;
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-tertiary);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .achievement-card:not(.unlocked) .achievement-lock {
        opacity: 1;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .achievements-grid {
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
          gap: var(--codeleaf-space-2);
        }

        .achievement-card {
          min-height: 100px;
          padding: var(--codeleaf-space-2);
        }

        .achievement-icon {
          font-size: 1.5rem;
        }

        .achievement-title {
          font-size: var(--codeleaf-font-xs);
        }
      }

      @media (max-width: 480px) {
        .achievements-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .achievement-tooltip {
          white-space: normal;
          width: 160px;
          text-align: center;
        }
      }
      /* Content Sections */
      .content-section {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        margin-bottom: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .content-grid {
        display: grid;
        gap: var(--codeleaf-space-4);
      }

      .content-item {
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-4);
        transition: all 0.2s ease;
      }

      .content-item:hover {
        border-color: var(--codeleaf-accent-muted);
        transform: translateY(-1px);
      }

      .question-item,
      .blog-item {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--codeleaf-space-3);
      }

      .question-info,
      .blog-info {
        flex: 1;
      }

      .question-title,
      .blog-title {
        font-weight: 600;
        color: var(--codeleaf-text-primary);
        margin-bottom: var(--codeleaf-space-1);
        line-height: 1.3;
      }

      .question-date,
      .blog-date {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
      }

      .question-link,
      .blog-link {
        color: var(--codeleaf-accent-primary);
        text-decoration: none;
        font-size: var(--codeleaf-font-sm);
        padding: var(--codeleaf-space-1) var(--codeleaf-space-2);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-sm);
        transition: all 0.2s ease;
      }

      .question-link:hover,
      .blog-link:hover {
        background: var(--codeleaf-accent-primary);
        color: white;
        border-color: var(--codeleaf-accent-primary);
      }

      /* User Directory */
      .user-directory {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .user-grid {
        display: grid;
        gap: var(--codeleaf-space-3);
        max-height: 400px;
        overflow-y: auto;
      }

      .user-item {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.2s ease;
      }

      .user-item:hover {
        border-color: var(--codeleaf-accent-muted);
        transform: translateX(4px);
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: var(--codeleaf-font-sm);
        font-weight: 600;
        flex-shrink: 0;
      }

      .user-details {
        flex: 1;
      }

      .user-name {
        font-weight: 600;
        color: var(--codeleaf-text-primary);
        margin-bottom: 2px;
      }

      .user-stats {
        display: flex;
        gap: var(--codeleaf-space-3);
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
      }

      .user-stat {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      /* Consistency Map - Mirror from index.html */
      .consistency-map {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .heatmap-container {
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-4);
      }

      .heatmap-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--codeleaf-space-4);
      }

      .heatmap-title {
        font-size: var(--codeleaf-font-lg);
        color: var(--codeleaf-text-primary);
        font-weight: 600;
      }

      .heatmap-legend {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-2);
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
      }

      .legend-colors {
        display: flex;
        gap: 2px;
      }

      .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 2px;
      }

      .legend-color.level-0 {
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
      }
      .legend-color.level-1 {
        background-color: #9be9a8;
      }
      .legend-color.level-2 {
        background-color: #40c463;
      }
      .legend-color.level-3 {
        background-color: #30a14e;
      }
      .legend-color.level-4 {
        background-color: #216e39;
      }

      .heatmap-content {
        display: flex;
        gap: var(--codeleaf-space-3);
      }

      .months-row {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding-top: 24px;
        width: 40px;
        flex-shrink: 0;
      }

      .month-label {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        height: 12px;
        text-align: right;
        padding-right: var(--codeleaf-space-2);
      }

      .heatmap-grid {
        display: grid;
        grid-template-columns: repeat(52, 12px);
        grid-auto-rows: 12px;
        gap: 3px;
        flex: 1;
      }

      .heatmap-cell {
        width: 12px;
        height: 12px;
        border-radius: 2px;
        cursor: pointer;
        transition: transform 0.1s ease;
      }

      .heatmap-cell:hover {
        transform: scale(1.3);
        z-index: 2;
      }

      .heatmap-cell.level-0 {
        background-color: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
      }
      .heatmap-cell.level-1 {
        background-color: #9be9a8;
      }
      .heatmap-cell.level-2 {
        background-color: #40c463;
      }
      .heatmap-cell.level-3 {
        background-color: #30a14e;
      }
      .heatmap-cell.level-4 {
        background-color: #216e39;
      }

      /* Progress Visualization */
      .progress-section {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .progress-bars {
        display: flex;
        flex-direction: column;
        gap: var(--codeleaf-space-4);
      }

      .progress-item {
        display: flex;
        flex-direction: column;
        gap: var(--codeleaf-space-2);
      }

      .progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .progress-label {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
        font-weight: 500;
      }

      .progress-value {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-accent-primary);
        font-weight: 600;
      }

      .progress-bar {
        height: 8px;
        background: var(--codeleaf-border-light);
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        border-radius: 4px;
        transition: width 0.8s ease;
      }

      /* Responsive Design */
      @media (max-width: 1200px) {
        .main-container {
          flex-direction: column;
        }

        .left-column,
        .right-column {
          flex: 1;
          width: 100%;
        }
      }

      @media (max-width: 768px) {
        .profile-header {
          flex-direction: column;
          text-align: center;
          gap: var(--codeleaf-space-4);
        }

        .profile-stats {
          grid-template-columns: repeat(2, 1fr);
        }

        .achievements-grid {
          grid-template-columns: 1fr;
        }

        .heatmap-grid {
          grid-template-columns: repeat(26, 10px);
          gap: 2px;
        }

        .heatmap-cell {
          width: 10px;
          height: 10px;
        }

        .months-row {
          width: 30px;
          padding-top: 20px;
        }

        .month-label {
          font-size: 0.6rem;
          height: 10px;
        }
      }

      @media (max-width: 480px) {
        .profile-stats {
          grid-template-columns: 1fr;
        }

        .heatmap-grid {
          grid-template-columns: repeat(13, 8px);
          gap: 1px;
        }

        .heatmap-cell {
          width: 8px;
          height: 8px;
        }

        .months-row {
          width: 25px;
          padding-top: 16px;
        }

        .month-label {
          font-size: 0.5rem;
          height: 8px;
        }

        .question-item,
        .blog-item {
          flex-direction: column;
          gap: var(--codeleaf-space-2);
        }

        .question-link,
        .blog-link {
          align-self: flex-start;
        }
      }

      /* Loading States */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: var(--codeleaf-space-8);
        color: var(--codeleaf-text-tertiary);
      }

      .loading::after {
        content: "";
        width: 20px;
        height: 20px;
        border: 2px solid var(--codeleaf-border-light);
        border-top: 2px solid var(--codeleaf-accent-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-left: var(--codeleaf-space-2);
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Empty States */
      .empty-state {
        text-align: center;
        padding: var(--codeleaf-space-8);
        color: var(--codeleaf-text-tertiary);
        font-style: italic;
      }

      /* Toast Notifications */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 400px;
      }

      .toast {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-left: 4px solid var(--codeleaf-accent-primary);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-4);
        box-shadow: var(--codeleaf-shadow-lg);
        display: flex;
        align-items: flex-start;
        gap: var(--codeleaf-space-3);
        transform: translateX(400px);
        opacity: 0;
        transition: all 0.3s ease-in-out;
      }

      .toast.show {
        transform: translateX(0);
        opacity: 1;
      }

      .toast.hide {
        transform: translateX(400px);
        opacity: 0;
      }

      .toast-icon {
        font-size: 1.2rem;
        flex-shrink: 0;
        margin-top: 2px;
      }

      .toast-content {
        flex: 1;
        min-width: 0;
      }

      .toast-title {
        font-weight: 600;
        margin-bottom: 4px;
        color: var(--codeleaf-text-primary);
        font-size: var(--codeleaf-font-sm);
      }

      .toast-message {
        color: var(--codeleaf-text-secondary);
        font-size: var(--codeleaf-font-sm);
        line-height: 1.4;
      }

      .toast-close {
        background: none;
        border: none;
        color: var(--codeleaf-text-tertiary);
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        font-size: 1.1rem;
      }

      .toast-close:hover {
        color: var(--codeleaf-text-primary);
        background: rgba(76, 166, 76, 0.1);
      }

      /* Enhanced Question History Styles */
      .question-day {
        transition: all 0.3s ease;
        border: 1px solid var(--codeleaf-border-light);
      }

      .question-day:hover {
        border-color: var(--codeleaf-accent-muted);
      }

      .question-day.expanded {
        border-color: var(--codeleaf-accent-primary);
        box-shadow: var(--codeleaf-shadow-md);
      }

      .question-day-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--codeleaf-space-3);
        cursor: pointer;
      }

      .question-day-info {
        flex: 1;
      }

      .question-day-stats {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-2);
        flex-shrink: 0;
      }

      .question-count {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-accent-primary);
        font-weight: 600;
        background: var(--codeleaf-bg-tertiary);
        padding: var(--codeleaf-space-1) var(--codeleaf-space-2);
        border-radius: var(--codeleaf-radius-sm);
        border: 1px solid var(--codeleaf-accent-muted);
      }

      .toggle-day-btn {
        background: none;
        border: none;
        padding: var(--codeleaf-space-1);
        border-radius: var(--codeleaf-radius-sm);
        cursor: pointer;
        color: var(--codeleaf-text-tertiary);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: auto;
        min-width: auto;
      }

      .toggle-day-btn:hover {
        background: var(--codeleaf-bg-tertiary);
        color: var(--codeleaf-accent-primary);
        transform: scale(1.1);
      }

      .toggle-icon {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: var(--codeleaf-font-sm);
        display: inline-block;
      }

      .question-day-details {
        margin-top: var(--codeleaf-space-4);
        padding-top: var(--codeleaf-space-4);
        border-top: 1px solid var(--codeleaf-border-light);
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .solved-questions-list {
        display: flex;
        flex-direction: column;
        gap: var(--codeleaf-space-3);
      }

      .solved-question-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.2s ease;
        animation: slideInUp 0.3s ease forwards;
      }

      .solved-question-item:hover {
        border-color: var(--codeleaf-accent-muted);
        transform: translateX(4px);
      }

      .solved-question-item:nth-child(1) {
        animation-delay: 0.05s;
      }
      .solved-question-item:nth-child(2) {
        animation-delay: 0.1s;
      }
      .solved-question-item:nth-child(3) {
        animation-delay: 0.15s;
      }
      .solved-question-item:nth-child(4) {
        animation-delay: 0.2s;
      }
      .solved-question-item:nth-child(5) {
        animation-delay: 0.25s;
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .question-text {
        flex: 1;
        font-weight: 500;
        color: var(--codeleaf-text-primary);
        line-height: 1.4;
      }

      .question-action-link {
        color: var(--codeleaf-accent-primary);
        text-decoration: none;
        font-size: var(--codeleaf-font-sm);
        padding: var(--codeleaf-space-1) var(--codeleaf-space-3);
        border: 1px solid var(--codeleaf-accent-primary);
        border-radius: var(--codeleaf-radius-sm);
        transition: all 0.2s ease;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .question-action-link:hover {
        background: var(--codeleaf-accent-primary);
        color: white;
        transform: translateY(-1px);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .empty-day-state {
        text-align: center;
        padding: var(--codeleaf-space-4);
        color: var(--codeleaf-text-tertiary);
        font-style: italic;
        background: var(--codeleaf-bg-secondary);
        border-radius: var(--codeleaf-radius-md);
        border: 1px dashed var(--codeleaf-border-light);
      }

      /* Responsive adjustments for question history */
      @media (max-width: 768px) {
        .question-day-header {
          flex-direction: column;
          align-items: flex-start;
          gap: var(--codeleaf-space-2);
        }

        .question-day-stats {
          align-self: flex-end;
        }

        .solved-question-item {
          flex-direction: column;
          align-items: flex-start;
          gap: var(--codeleaf-space-2);
        }

        .question-action-link {
          align-self: flex-start;
        }
      }

      @media (max-width: 480px) {
        .question-count {
          font-size: var(--codeleaf-font-xs);
        }

        .solved-question-item {
          padding: var(--codeleaf-space-2);
        }
      }

      /* Add subtle animation for the toggle button */
      .toggle-day-btn {
        background: none;
        border: none;
        padding: var(--codeleaf-space-1);
        border-radius: var(--codeleaf-radius-sm);
        cursor: pointer;
        color: var(--codeleaf-text-tertiary);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: auto;
        min-width: auto;
        position: relative;
      }

      .toggle-day-btn:hover {
        background: var(--codeleaf-bg-tertiary);
        color: var(--codeleaf-accent-primary);
        transform: scale(1.1);
      }

      .toggle-day-btn:active {
        transform: scale(0.95);
      }

      /* Enhanced visual states for expanded days */
      .question-day.expanded {
        border-color: var(--codeleaf-accent-primary);
        box-shadow: var(--codeleaf-shadow-md);
        background: linear-gradient(
          135deg,
          var(--codeleaf-bg-primary),
          var(--codeleaf-bg-secondary)
        );
      }

      .question-day.expanded .question-count {
        background: var(--codeleaf-accent-primary);
        color: white;
        border-color: var(--codeleaf-accent-primary);
      }

      .question-day.expanded .toggle-day-btn {
        color: var(--codeleaf-accent-primary);
        background: var(--codeleaf-bg-tertiary);
      }

      /* Smooth transition for the entire day card */
      .question-day {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        overflow: hidden;
      }

      /* Enhanced question items with staggered animation */
      .solved-question-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.2s ease;
        animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        opacity: 0;
        transform: translateY(8px);
      }

      /* Staggered animation for better visual appeal */
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(1) {
        animation-delay: 0.05s;
      }
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(2) {
        animation-delay: 0.1s;
      }
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(3) {
        animation-delay: 0.15s;
      }
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(4) {
        animation-delay: 0.2s;
      }
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(5) {
        animation-delay: 0.25s;
      }
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(6) {
        animation-delay: 0.3s;
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Enhanced focus states for accessibility */
      .toggle-day-btn:focus-visible {
        outline: 2px solid var(--codeleaf-accent-primary);
        outline-offset: 2px;
      }

      .question-action-link:focus-visible {
        outline: 2px solid var(--codeleaf-accent-primary);
        outline-offset: 2px;
      }

      /* Enhanced Community Section Styles */
      .user-item {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .user-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(76, 166, 76, 0.1),
          transparent
        );
        transition: left 0.6s ease;
      }

      .user-item:hover::before {
        left: 100%;
      }

      .user-item:hover {
        border-color: var(--codeleaf-accent-muted);
        transform: translateY(-2px);
        box-shadow: var(--codeleaf-shadow-md);
      }

      .user-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: var(--codeleaf-font-lg);
        font-weight: 600;
        flex-shrink: 0;
        border: 3px solid var(--codeleaf-bg-primary);
        box-shadow: var(--codeleaf-shadow-sm);
        transition: all 0.3s ease;
      }

      .user-item:hover .user-avatar {
        transform: scale(1.1);
        box-shadow: var(--codeleaf-shadow-md);
      }

      .user-details {
        flex: 1;
        min-width: 0;
      }

      .user-name {
        font-weight: 600;
        color: var(--codeleaf-text-primary);
        margin-bottom: var(--codeleaf-space-1);
        font-size: var(--codeleaf-font-sm);
        line-height: 1.2;
      }

      .user-stats {
        display: flex;
        gap: var(--codeleaf-space-2);
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        flex-wrap: wrap;
      }

      .user-stat {
        display: flex;
        align-items: center;
        gap: 2px;
        background: var(--codeleaf-bg-primary);
        padding: 2px 6px;
        border-radius: 10px;
        border: 1px solid var(--codeleaf-border-light);
      }

      .user-action {
        color: var(--codeleaf-accent-primary);
        font-size: var(--codeleaf-font-xs);
        font-weight: 600;
        padding: var(--codeleaf-space-1) var(--codeleaf-space-2);
        border: 1px solid var(--codeleaf-accent-muted);
        border-radius: var(--codeleaf-radius-sm);
        background: var(--codeleaf-bg-primary);
        transition: all 0.2s ease;
        flex-shrink: 0;
        opacity: 0;
        transform: translateX(10px);
      }

      .user-item:hover .user-action {
        opacity: 1;
        transform: translateX(0);
      }

      /* Empty state enhancements */
      .empty-state {
        text-align: center;
        padding: var(--codeleaf-space-6);
        color: var(--codeleaf-text-tertiary);
        font-style: italic;
        background: var(--codeleaf-bg-secondary);
        border-radius: var(--codeleaf-radius-md);
        border: 1px dashed var(--codeleaf-border-light);
      }

      .empty-state small {
        display: block;
        margin-top: var(--codeleaf-space-1);
        opacity: 0.7;
        font-size: var(--codeleaf-font-xs);
      }

      /* Loading animation */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: var(--codeleaf-space-6);
        color: var(--codeleaf-text-tertiary);
        gap: var(--codeleaf-space-2);
      }

      .loading::after {
        content: "";
        width: 16px;
        height: 16px;
        border: 2px solid var(--codeleaf-border-light);
        border-top: 2px solid var(--codeleaf-accent-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .user-item {
          padding: var(--codeleaf-space-2);
        }

        .user-avatar {
          width: 40px;
          height: 40px;
          font-size: var(--codeleaf-font-base);
        }

        .user-stats {
          gap: var(--codeleaf-space-1);
        }

        .user-stat {
          padding: 1px 4px;
          font-size: 0.65rem;
        }

        .user-action {
          display: none; /* Hide on mobile for cleaner look */
        }
      }

      @media (max-width: 480px) {
        .user-item {
          flex-direction: column;
          text-align: center;
          gap: var(--codeleaf-space-2);
        }

        .user-details {
          width: 100%;
        }

        .user-stats {
          justify-content: center;
        }
      }

      /* Animation for user items */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .user-item {
        animation: fadeInUp 0.5s ease forwards;
        opacity: 0;
      }

      .user-item:nth-child(1) {
        animation-delay: 0.1s;
      }
      .user-item:nth-child(2) {
        animation-delay: 0.2s;
      }
      .user-item:nth-child(3) {
        animation-delay: 0.3s;
      }
      .user-item:nth-child(4) {
        animation-delay: 0.4s;
      }
      .user-item:nth-child(5) {
        animation-delay: 0.5s;
      }

      /* Add a small indicator that this is someone else's profile */
      .profile-owner-badge {
        background: var(--codeleaf-accent-muted);
        color: var(--codeleaf-accent-primary);
        padding: var(--codeleaf-space-1) var(--codeleaf-space-3);
        border-radius: 12px;
        font-size: var(--codeleaf-font-xs);
        font-weight: 600;
        margin-left: var(--codeleaf-space-2);
        border: 1px solid var(--codeleaf-accent-muted);
      }

      /* Enhanced Profile Header Styles */
      .profile-name-container {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        flex-wrap: wrap;
        margin-bottom: var(--codeleaf-space-2);
      }

      .user-level-badge {
        position: absolute;
        bottom: -8px;
        right: -8px;
        background: linear-gradient(
          135deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: var(--codeleaf-font-xs);
        font-weight: 700;
        border: 3px solid var(--codeleaf-bg-primary);
        box-shadow: var(--codeleaf-shadow-sm);
        z-index: 2;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .avatar-container {
        position: relative;
        flex-shrink: 0;
      }

      .profile-badge {
        background: var(--codeleaf-accent-muted);
        color: var(--codeleaf-accent-primary);
        padding: 4px 12px;
        border-radius: 12px;
        font-size: var(--codeleaf-font-xs);
        font-weight: 600;
        border: 1px solid var(--codeleaf-accent-muted);
      }

      .stat-trend {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        margin-top: 4px;
        font-weight: 500;
      }

      /* Profile Details Grid */
      .profile-details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: var(--codeleaf-space-3);
        margin-top: var(--codeleaf-space-4);
        padding-top: var(--codeleaf-space-4);
        border-top: 1px solid var(--codeleaf-border-light);
      }

      .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--codeleaf-space-2);
        background: var(--codeleaf-bg-secondary);
        border-radius: var(--codeleaf-radius-sm);
        border: 1px solid var(--codeleaf-border-light);
      }

      .detail-label {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        font-weight: 500;
      }

      .detail-value {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-accent-primary);
        font-weight: 600;
      }

      /* Level Badge Colors */
      .user-level-badge.noob {
        background: linear-gradient(135deg, #6b856b, #88a488);
      }
      .user-level-badge.beginner {
        background: linear-gradient(135deg, #4ca64c, #5cb85c);
      }
      .user-level-badge.intermediate {
        background: linear-gradient(135deg, #2d7a2d, #4ca64c);
      }
      .user-level-badge.advanced {
        background: linear-gradient(135deg, #1a5a1a, #2d7a2d);
      }
      .user-level-badge.expert {
        background: linear-gradient(135deg, #0a3a0a, #1a5a1a);
      }
      .user-level-badge.master {
        background: linear-gradient(135deg, #002200, #0a3a0a);
      }
      .user-level-badge.champion {
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        color: #1a3a1a;
      }

      /* Responsive Design for Enhanced Header */
      @media (max-width: 768px) {
        .profile-details-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .profile-name-container {
          flex-direction: column;
          align-items: flex-start;
          gap: var(--codeleaf-space-2);
        }
      }

      @media (max-width: 480px) {
        .profile-details-grid {
          grid-template-columns: 1fr;
        }

        .user-level-badge {
          bottom: -6px;
          right: -6px;
          font-size: 0.6rem;
          padding: 3px 8px;
        }
      }

      /* Level Badge Colors - Updated for new level names */
      .user-level-badge.fresh-coder {
        background: linear-gradient(135deg, #6b856b, #88a488);
        color: white;
      }
      .user-level-badge.syntax-sprout {
        background: linear-gradient(135deg, #4ca64c, #5cb85c);
        color: white;
      }
      .user-level-badge.pattern-explorer {
        background: linear-gradient(135deg, #2d7a2d, #4ca64c);
        color: white;
      }
      .user-level-badge.logic-virtuoso {
        background: linear-gradient(135deg, #1a5a1a, #2d7a2d);
        color: white;
      }
      .user-level-badge.algorithm-sage {
        background: linear-gradient(135deg, #0a3a0a, #1a5a1a);
        color: white;
      }
      .user-level-badge.flow-master {
        background: linear-gradient(135deg, #002200, #0a3a0a);
        color: white;
      }
      .user-level-badge.code-luminary {
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        color: #1a3a1a;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* Level Up Guide Styles */
      .level-up-guide {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .guide-content {
        display: flex;
        flex-direction: column;
        gap: var(--codeleaf-space-4);
      }

      .guide-tips,
      .xp-breakdown,
      .level-meanings {
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-4);
      }

      .guide-tips h3,
      .xp-breakdown h3,
      .level-meanings h3 {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-accent-primary);
        margin-bottom: var(--codeleaf-space-3);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-2);
      }

      /* Tips Styles */
      .tip-item {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-2) 0;
        border-bottom: 1px solid var(--codeleaf-border-light);
      }

      .tip-item:last-child {
        border-bottom: none;
      }

      .tip-icon {
        font-size: var(--codeleaf-font-lg);
        flex-shrink: 0;
        width: 24px;
        text-align: center;
      }

      .tip-text {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
        line-height: 1.4;
      }

      /* XP Breakdown Styles */
      .xp-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--codeleaf-space-2) 0;
        border-bottom: 1px solid var(--codeleaf-border-light);
      }

      .xp-item:last-child {
        border-bottom: none;
      }

      .xp-source {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
      }

      .xp-value {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-accent-primary);
        font-weight: 600;
        background: var(--codeleaf-bg-primary);
        padding: 2px 8px;
        border-radius: 12px;
        border: 1px solid var(--codeleaf-accent-muted);
      }

      /* Level Meanings Styles */
      .level-item {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-2) 0;
        border-bottom: 1px solid var(--codeleaf-border-light);
      }

      .level-item:last-child {
        border-bottom: none;
      }

      .level-badge-small {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--codeleaf-font-sm);
        flex-shrink: 0;
        border: 2px solid var(--codeleaf-bg-primary);
      }

      .level-info {
        flex: 1;
      }

      .level-info strong {
        display: block;
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
        margin-bottom: 2px;
      }

      .level-info small {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        line-height: 1.3;
      }

      /* Level badge colors for the guide */
      .level-badge-small.seedling {
        background: linear-gradient(135deg, #6b856b, #88a488);
      }
      .level-badge-small.sprout {
        background: linear-gradient(135deg, #4ca64c, #5cb85c);
      }
      .level-badge-small.builder {
        background: linear-gradient(135deg, #2d7a2d, #4ca64c);
      }
      .level-badge-small.explorer {
        background: linear-gradient(135deg, #1a5a1a, #2d7a2d);
      }
      .level-badge-small.sage {
        background: linear-gradient(135deg, #0a3a0a, #1a5a1a);
      }
      .level-badge-small.virtuoso {
        background: linear-gradient(135deg, #002200, #0a3a0a);
      }
      .level-badge-small.luminary {
        background: linear-gradient(135deg, #ffd700, #ffed4e);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .guide-content {
          gap: var(--codeleaf-space-3);
        }

        .guide-tips,
        .xp-breakdown,
        .level-meanings {
          padding: var(--codeleaf-space-3);
        }

        .tip-item,
        .xp-item,
        .level-item {
          padding: var(--codeleaf-space-1) 0;
        }

        .level-badge-small {
          width: 28px;
          height: 28px;
          font-size: var(--codeleaf-font-xs);
        }
      }

      @media (max-width: 480px) {
        .level-up-guide {
          padding: var(--codeleaf-space-4);
        }

        .tip-item,
        .xp-item {
          flex-direction: column;
          align-items: flex-start;
          gap: var(--codeleaf-space-1);
        }

        .xp-value {
          align-self: flex-start;
        }
      }

      /* Enhanced Social Links Section - View Only */
      .social-links-section {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-4);
        margin-bottom: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .social-links-section:hover {
        box-shadow: var(--codeleaf-shadow-md);
      }

      .social-links-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(76, 166, 76, 0.03),
          transparent
        );
        transition: left 0.8s ease;
      }

      .social-links-section:hover::before {
        left: 100%;
      }

      .social-links-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--codeleaf-space-3);
      }

      .social-links-title {
        font-size: var(--codeleaf-font-lg);
        color: var(--codeleaf-accent-primary);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-2);
      }

      /* Social Links Display - Enhanced */
      .social-links-display {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--codeleaf-space-3);
      }

      .social-link-display-item {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        cursor: pointer;
        text-decoration: none;
        color: inherit;
        position: relative;
        overflow: hidden;
      }

      .social-link-display-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(76, 166, 76, 0.05),
          transparent
        );
        transition: left 0.6s ease;
      }

      .social-link-display-item:hover::before {
        left: 100%;
      }

      .social-link-display-item:hover {
        border-color: var(--codeleaf-accent-muted);
        transform: translateY(-2px);
        box-shadow: var(--codeleaf-shadow-sm);
        text-decoration: none;
        color: inherit;
      }

      .social-link-icon {
        font-size: var(--codeleaf-font-lg);
        width: 24px;
        text-align: center;
        flex-shrink: 0;
        transition: transform 0.3s ease;
      }

      .social-link-display-item:hover .social-link-icon {
        transform: scale(1.1);
      }

      .social-link-content {
        flex: 1;
        min-width: 0;
      }

      .social-link-platform {
        font-weight: 600;
        color: var(--codeleaf-text-primary);
        font-size: var(--codeleaf-font-sm);
        margin-bottom: 2px;
        transition: color 0.3s ease;
      }

      .social-link-display-item:hover .social-link-platform {
        color: var(--codeleaf-accent-primary);
      }

      .social-link-url {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        transition: color 0.3s ease;
      }

      .social-link-display-item:hover .social-link-url {
        color: var(--codeleaf-text-secondary);
      }

      .social-link-display-item:not([href]) {
        cursor: default;
        opacity: 0.7;
      }

      .social-link-display-item:not([href]):hover {
        transform: none;
        border-color: var(--codeleaf-border-light);
      }

      .social-link-display-item:not([href])::before {
        display: none;
      }

      /* Platform-specific colors with subtle accents */
      .social-link-display-item[data-platform="linkedin"] {
        border-left: 3px solid rgba(0, 119, 181, 0.3);
      }

      .social-link-display-item[data-platform="github"] {
        border-left: 3px solid rgba(51, 51, 51, 0.3);
      }

      .social-link-display-item[data-platform="leetcode"] {
        border-left: 3px solid rgba(29, 161, 242, 0.3);
      }

      .social-link-display-item[data-platform="gfg"] {
        border-left: 3px solid rgba(45, 122, 45, 0.3);
      }

      .social-link-display-item[data-platform="linkedin"]:hover {
        border-left-color: #0077b5;
      }

      .social-link-display-item[data-platform="github"]:hover {
        border-left-color: #333;
      }

      .social-link-display-item[data-platform="leetcode"]:hover {
        border-left-color: #1da1f2;
      }

      .social-link-display-item[data-platform="gfg"]:hover {
        border-left-color: #2d7a2d;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .social-links-display {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 480px) {
        .social-links-section {
          padding: var(--codeleaf-space-3);
        }

        .social-links-title {
          font-size: var(--codeleaf-font-base);
        }
      }

      /* Premium Progress Chart Styles */
      .progress-chart-section {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        margin-bottom: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
        position: relative;
        overflow: hidden;
      }

      .progress-chart-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          var(--codeleaf-accent-primary),
          transparent
        );
      }

      .progress-chart-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--codeleaf-space-6);
      }

      /* Unified Chart Wrapper */
      .progress-chart-wrapper {
        position: relative;
        width: 200px;
        height: 200px;
        margin: 0 auto;
        cursor: pointer;
      }

      .progress-chart-svg {
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
        transition: all 0.6s cubic-bezier(0.25, 1, 0.5, 1);
      }

      /* Single Continuous Circle - No Gaps */
      .progress-circle {
        fill: none;
        stroke-linecap: butt;
        transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1);
        transform-origin: center;
      }

      .progress-circle.total {
        stroke-width: 8;
        stroke: var(--codeleaf-bg-tertiary);
        opacity: 0.15;
      }

      .progress-circle.easy {
        stroke-width: 8;
        stroke: var(--codeleaf-success);
      }

      .progress-circle.medium {
        stroke-width: 8;
        stroke: var(--codeleaf-warning);
      }

      .progress-circle.hard {
        stroke-width: 8;
        stroke: var(--codeleaf-error);
      }

      /* Enhanced Center Content */
      .progress-chart-center {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        pointer-events: none;
        background: var(--codeleaf-bg-primary);
        border-radius: 50%;
        width: 120px;
        height: 120px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--codeleaf-border-light);
        transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
      }

      .progress-total {
        font-size: var(--codeleaf-font-2xl);
        font-weight: 800;
        color: transparent;
        line-height: 1;
        margin-bottom: var(--codeleaf-space-1);
        background: linear-gradient(
          135deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        -webkit-background-clip: text;
        background-clip: text;
        transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
      }

      .progress-label {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-secondary);
        font-weight: 600;
        letter-spacing: 0.3px;
        transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
      }

      /* Enhanced Legend - Clean & Interactive */
      .progress-legend {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--codeleaf-space-3);
        width: 100%;
        max-width: 360px;
      }

      .legend-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--codeleaf-space-2);
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        cursor: default;
        transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        position: relative;
        overflow: hidden;
      }

      .legend-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(76, 166, 76, 0.1),
          transparent
        );
        transition: left 0.6s ease;
      }

      .legend-item:hover::before {
        left: 100%;
      }

      .legend-item:hover {
        border-color: var(--codeleaf-accent-muted);
        transform: translateY(-2px);
        box-shadow: var(--codeleaf-shadow-md);
      }

      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        flex-shrink: 0;
        position: relative;
        transition: all 0.3s ease;
        border: 2px solid var(--codeleaf-bg-primary);
      }

      .legend-color.easy {
        background: var(--codeleaf-success);
      }

      .legend-color.medium {
        background: var(--codeleaf-warning);
      }

      .legend-color.hard {
        background: var(--codeleaf-error);
      }

      .legend-text {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
      }

      .legend-difficulty {
        font-size: var(--codeleaf-font-sm);
        font-weight: 700;
        color: var(--codeleaf-text-primary);
        letter-spacing: 0.3px;
      }

      .legend-count {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        font-weight: 600;
      }

      .legend-percentage {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-accent-primary);
        font-weight: 700;
        background: var(--codeleaf-bg-tertiary);
        padding: 2px 8px;
        border-radius: 12px;
      }

      /* Enhanced Tooltip */
      .progress-tooltip {
        position: absolute;
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-3);
        box-shadow: var(--codeleaf-shadow-lg);
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
        white-space: nowrap;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        pointer-events: none;
        backdrop-filter: blur(10px);
      }

      .progress-tooltip::after {
        content: "";
        position: absolute;
        bottom: -6px;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: var(--codeleaf-bg-primary);
      }

      .progress-tooltip.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(-8px);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .progress-chart-wrapper {
          width: 180px;
          height: 180px;
        }

        .progress-chart-center {
          width: 100px;
          height: 100px;
        }

        .progress-total {
          font-size: var(--codeleaf-font-xl);
        }

        .progress-label {
          font-size: var(--codeleaf-font-xs);
        }

        .progress-legend {
          grid-template-columns: 1fr;
          gap: var(--codeleaf-space-2);
        }

        .legend-item {
          flex-direction: row;
          justify-content: flex-start;
          padding: var(--codeleaf-space-2);
        }

        .legend-text {
          align-items: flex-start;
          flex: 1;
        }
      }

      @media (max-width: 480px) {
        .progress-chart-wrapper {
          width: 160px;
          height: 160px;
        }

        .progress-chart-center {
          width: 90px;
          height: 90px;
        }

        .progress-total {
          font-size: var(--codeleaf-font-lg);
        }

        .legend-color {
          width: 14px;
          height: 14px;
        }

        .legend-difficulty {
          font-size: var(--codeleaf-font-xs);
        }
      }

      /* Add these animations to the existing CSS */

      /* Chart States */
      .progress-chart-wrapper.filtered .progress-circle:not(.active) {
        opacity: 0.3;
      }

      .progress-chart-wrapper.filtered .progress-circle.active {
        stroke-width: 10;
      }

      /* Enhanced active states */
      .legend-item.active {
        background: var(--codeleaf-bg-primary);
        border-color: var(--codeleaf-accent-primary);
        box-shadow: var(--codeleaf-shadow-lg);
        transform: translateY(-1px);
      }

      .legend-item.active .legend-color {
        transform: scale(1.2);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      .legend-item.active .legend-percentage {
        background: var(--codeleaf-accent-primary);
        color: white;
      }

      /* Ripple effect for interactions */
      .ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(76, 166, 76, 0.3);
        transform: scale(0);
        animation: rippleEffect 0.6s linear;
        pointer-events: none;
      }

      @keyframes rippleEffect {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
        100% {
          transform: scale(1.2);
          opacity: 0;
        }
      }

      /* Premium Animations */
      @keyframes chartEntrance {
        0% {
          opacity: 0;
          transform: scale(0.8);
        }
        60% {
          opacity: 1;
          transform: scale(1.05);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes segmentPulse {
        0%,
        100% {
          stroke-width: 8;
        }
        50% {
          stroke-width: 10;
        }
      }

      @keyframes premiumPulse {
        0%,
        100% {
          stroke-width: 8;
        }
        25% {
          stroke-width: 9;
        }
        50% {
          stroke-width: 10;
        }
        75% {
          stroke-width: 9;
        }
      }

      @keyframes countSpring {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.4);
        }
        100% {
          transform: scale(1);
        }
      }

      .progress-total.animating {
        animation: countSpring 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      /* Enhanced hover effects for legend */
      .legend-item:hover:not(.active) {
        transform: translateY(-3px) scale(1.02);
        box-shadow: var(--codeleaf-shadow-lg);
      }

      /* Active segment highlighting */
      .progress-circle.active {
        animation: premiumPulse 2s ease-in-out infinite;
        z-index: 2;
      }

      /* Enhanced transitions */
      .progress-circle {
        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      .progress-chart-center {
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      .legend-item {
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      /* Segment highlight on hover */
      .progress-circle:hover {
        animation: segmentPulse 1s ease-in-out;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-container">
          <h1 class="site-logo">
            FocusFlow
            <span class="profile-owner-badge" id="profileOwnerBadge"
              >User Profile</span
            >
          </h1>
          <div class="nav-links">
            <a href="/index.html" class="nav-link">← Back to Tracker</a>
            <a href="/blogs.html" class="nav-link">📝 Blogs</a>
            <a href="/profile.html" class="nav-link">👤 My Profile</a>
          </div>
        </div>
      </header>

      <!-- Reuse the exact same structure as profile.html -->
      <div class="main-container">
        <!-- Left Column (70%) -->
        <div class="left-column">
          <!-- Profile Header -->
          <!-- Enhanced Profile Header -->
          <div class="profile-header">
            <div class="avatar-container">
              <div class="pixel-avatar" id="userAvatar">👤</div>
              <div class="user-level-badge" id="userLevelBadge">Noob</div>
            </div>
            <div class="profile-info">
              <div class="profile-name-container">
                <h1 class="profile-name" id="userName">Loading...</h1>
                <div class="profile-badge" id="profileOwnerBadge">
                  My Profile
                </div>
              </div>
              <p class="profile-bio" id="userBio">
                Member since <span id="joinDate">...</span>
              </p>

              <!-- Enhanced Stats Grid -->
              <div class="profile-stats">
                <div class="stat-item">
                  <div class="stat-value" id="totalSolved">0</div>
                  <div class="stat-label">Problems Solved</div>
                  <div class="stat-trend" id="solvedTrend">+0 today</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="totalBlogs">0</div>
                  <div class="stat-label">Blogs Written</div>
                  <div class="stat-trend" id="blogsTrend">+0 this week</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="currentStreak">0</div>
                  <div class="stat-label">Day Streak</div>
                  <div class="stat-trend" id="streakStatus">Keep going! 🔥</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="activeDays">0</div>
                  <div class="stat-label">Active Days</div>
                  <div class="stat-trend" id="activityTrend">Consistency</div>
                </div>
              </div>

              <!-- Additional Profile Details -->
              <div class="profile-details-grid">
                <div class="detail-item">
                  <span class="detail-label">Current Level</span>
                  <span class="detail-value" id="userLevel">Noob</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Total XP</span>
                  <span class="detail-value" id="totalXP">0</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Avg. Daily</span>
                  <span class="detail-value" id="avgDaily">0</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Max Streak</span>
                  <span class="detail-value" id="maxStreak">0</span>
                </div>
              </div>

              <!-- Enhanced Social Links Section - View Only -->
              <div
                class="social-links-section"
                id="socialLinksSection"
                style="margin-top: 20px"
              >
                <div class="social-links-header">
                  <h2 class="social-links-title">🔗 Social Links</h2>
                </div>

                <!-- Display View Only -->
                <div class="social-links-display" id="socialLinksDisplay">
                  <!-- Social links will be dynamically inserted here -->
                  <div class="loading">Loading social links...</div>
                </div>
              </div>
            </div>
          </div>
          <!-- Achievements Section -->
          <div class="achievements-section">
            <h2 class="section-title">🏆 Achievements</h2>
            <div class="achievements-grid" id="achievementsGrid">
              <div class="loading">Loading achievements...</div>
            </div>
          </div>

          <!-- Question History -->
          <div class="content-section">
            <h2 class="section-title">📚 Question History</h2>
            <div class="content-grid" id="questionHistory">
              <div class="loading">Loading question history...</div>
            </div>
          </div>

          <!-- Blogs Section -->
          <div class="content-section">
            <h2 class="section-title">✍️ Blogs</h2>
            <div class="content-grid" id="blogsContent">
              <div class="loading">Loading blogs...</div>
            </div>
          </div>
        </div>

        <!-- Right Column (30%) -->
        <div class="right-column">
          <!-- Premium Interactive Progress Chart -->
          <div class="progress-chart-section">
            <h2 class="section-title">🎯 Progress Overview</h2>
            <div class="progress-chart-container" id="progressChartContainer">
              <div
                class="progress-chart-wrapper"
                id="progressChartWrapper"
                tabindex="0"
                role="application"
                aria-label="Progress chart showing solved problems by difficulty level"
              >
                <svg
                  class="progress-chart-svg"
                  viewBox="0 0 100 100"
                  aria-hidden="true"
                >
                  <!-- Total background circle -->
                  <circle
                    class="progress-circle total"
                    cx="50"
                    cy="50"
                    r="44"
                    data-difficulty="total"
                    data-count="0"
                  />

                  <!-- Progress segments will be dynamically inserted here in order: Easy -> Medium -> Hard -->
                </svg>

                <!-- Center content -->
                <div class="progress-chart-center" id="progressChartCenter">
                  <div class="progress-total" id="progressTotal">0</div>
                  <div class="progress-label" id="progressLabel">
                    Total Solved
                  </div>
                </div>

                <!-- Tooltip -->
                <div class="progress-tooltip" id="progressTooltip"></div>
              </div>

              <!-- Enhanced Legend -->
              <div
                class="progress-legend"
                id="progressLegend"
                role="radiogroup"
                aria-label="Filter by difficulty level"
              >
                <!-- Legend items will be dynamically inserted here -->
              </div>
            </div>
          </div>
          <!-- Consistency Map -->
          <div class="consistency-map">
            <h2 class="section-title">📈 Consistency Map</h2>
            <div class="heatmap-container">
              <div class="heatmap-header">
                <div class="heatmap-title">Activity Heatmap</div>
                <div class="heatmap-legend">
                  <span>Less</span>
                  <div class="legend-colors">
                    <div class="legend-color level-0"></div>
                    <div class="legend-color level-1"></div>
                    <div class="legend-color level-2"></div>
                    <div class="legend-color level-3"></div>
                    <div class="legend-color level-4"></div>
                  </div>
                  <span>More</span>
                </div>
              </div>
              <div class="heatmap-content">
                <div class="months-row" id="heatmapMonths">
                  <!-- Month labels will be generated by JavaScript -->
                </div>
                <div class="heatmap-grid" id="heatmapGrid">
                  <!-- Heatmap cells will be generated by JavaScript -->
                </div>
              </div>
            </div>
          </div>

          <!-- Progress Visualization -->
          <div class="progress-section">
            <h2 class="section-title">📊 Progress Overview</h2>
            <div class="progress-bars" id="progressBars">
              <div class="loading">Loading progress data...</div>
            </div>
          </div>

          <!-- User Directory - ADD THIS SECTION -->
          <div class="user-directory">
            <h2 class="section-title">👥 Community</h2>
            <div class="user-grid" id="userDirectory">
              <div class="loading">Loading community data...</div>
            </div>
          </div>

          <!-- Level Up Guide Section -->
          <div class="level-up-guide">
            <h2 class="section-title">🚀 How to Level Up</h2>
            <div class="guide-content">
              <!-- Quick Tips -->
              <div class="guide-tips">
                <h3>💡 Quick Tips</h3>
                <div class="tip-item">
                  <span class="tip-icon">📚</span>
                  <span class="tip-text"
                    >Solve problems daily to build consistency</span
                  >
                </div>
                <div class="tip-item">
                  <span class="tip-icon">✍️</span>
                  <span class="tip-text"
                    >Write blogs to share knowledge (+25 XP each)</span
                  >
                </div>
                <div class="tip-item">
                  <span class="tip-icon">🔥</span>
                  <span class="tip-text">Maintain streaks for bonus XP</span>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">💬</span>
                  <span class="tip-text">Engage with community blogs</span>
                </div>
              </div>

              <!-- XP Breakdown -->
              <div class="xp-breakdown">
                <h3>🏆 XP Breakdown</h3>
                <div class="xp-item">
                  <span class="xp-source">Problems Solved</span>
                  <span class="xp-value">+10 XP each</span>
                </div>
                <div class="xp-item">
                  <span class="xp-source">Blogs Published</span>
                  <span class="xp-value">+25 XP each</span>
                </div>
                <div class="xp-item">
                  <span class="xp-source">Daily Streak</span>
                  <span class="xp-value">+5 XP per day</span>
                </div>
                <div class="xp-item">
                  <span class="xp-source">Blog Likes Received</span>
                  <span class="xp-value">+3 XP each</span>
                </div>
              </div>

              <!-- Level Meanings -->
              <div class="level-meanings">
                <h3>📊 Level Guide</h3>
                <div class="level-item">
                  <span class="level-badge-small seedling">🌱</span>
                  <div class="level-info">
                    <strong>Seedling</strong>
                    <small>Just starting your coding journey</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small sprout">🌿</span>
                  <div class="level-info">
                    <strong>Sprout</strong>
                    <small>Growing your skills steadily</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small builder">🔨</span>
                  <div class="level-info">
                    <strong>Builder</strong>
                    <small>Building solid foundations</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small explorer">🧭</span>
                  <div class="level-info">
                    <strong>Explorer</strong>
                    <small>Exploring advanced concepts</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small sage">📚</span>
                  <div class="level-info">
                    <strong>Sage</strong>
                    <small>Gaining deep knowledge</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small virtuoso">🎼</span>
                  <div class="level-info">
                    <strong>Virtuoso</strong>
                    <small>Mastering the craft</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small luminary">🌟</span>
                  <div class="level-info">
                    <strong>Luminary</strong>
                    <small>Shining example to the community</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Modified version of profile.js that loads data for the specified user
      const API_BASE_URL = "https://focus-flow-lopn.onrender.com/api";
      let currentViewingUser = null;

      // Get username from URL parameters
      function getTargetUsername() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("user");
      }

      // Load user profile data for the target user
      async function loadUserProfile() {
        const targetUsername = getTargetUsername();
        if (!targetUsername) {
          window.location.href = "/profile.html";
          return;
        }

        try {
          const token = localStorage.getItem("authToken");
          const response = await fetch(
            `${API_BASE_URL}/user-info/${encodeURIComponent(targetUsername)}`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("Failed to load user data");
          }

          const result = await response.json();

          if (result.success) {
            currentViewingUser = result.user;
            renderUserProfile();
            renderAchievements();
            renderQuestionHistory();
            renderBlogs();
            renderConsistencyMap();
            renderProgressBars();
            loadUserDirectory();
            // Load the new sections
            await loadSocialLinks();
            initializeProgressChart(); // Add this line
          } else {
            throw new Error(result.error || "Failed to load user data");
          }
        } catch (error) {
          console.error("Error loading user profile:", error);
          // Show error and redirect after delay
          showError(
            "User not found or access denied. Redirecting to your profile..."
          );
          setTimeout(() => {
            window.location.href = "/profile.html";
          }, 3000);
        }
      }

      // Load social links for the viewed user
      async function loadSocialLinks() {
        const targetUsername = getTargetUsername();
        if (!targetUsername) return;

        try {
          const token = localStorage.getItem("authToken");
          const response = await fetch(
            `${API_BASE_URL}/social-links/${encodeURIComponent(
              targetUsername
            )}`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("Failed to load social links");
          }

          const result = await response.json();

          if (result.success) {
            renderSocialLinks(result.socialLinks);
          } else {
            throw new Error(result.error || "Failed to load social links");
          }
        } catch (error) {
          console.error("Error loading social links:", error);
          // Initialize with empty data
          renderSocialLinks({
            linkedin: "",
            github: "",
            leetcode: "",
            gfg: "",
          });
        }
      }

      // Enhanced render function for view-only social links
      function renderSocialLinks(socialLinksData) {
        const displayContainer = document.getElementById("socialLinksDisplay");

        if (!displayContainer) return;

        // Social platforms configuration
        const platforms = [
          {
            key: "linkedin",
            name: "LinkedIn",
            icon: "💼",
          },
          {
            key: "github",
            name: "GitHub",
            icon: "🐙",
          },
          {
            key: "leetcode",
            name: "LeetCode",
            icon: "🐦",
          },
          {
            key: "gfg",
            name: "GeeksforGeeks",
            icon: "🌐",
          },
        ];

        // Render display view only
        displayContainer.innerHTML = platforms
          .map((platform) => {
            const url = socialLinksData[platform.key];
            const hasLink = url && url.trim() !== "";
            const displayUrl = hasLink ? url : "Not set";

            return `
        <a href="${hasLink ? url : "#"}" 
           class="social-link-display-item" 
           data-platform="${platform.key}"
           ${
             hasLink
               ? 'target="_blank" rel="noopener noreferrer"'
               : 'onclick="return false;"'
           }>
          <div class="social-link-icon">${platform.icon}</div>
          <div class="social-link-content">
            <div class="social-link-platform">${platform.name}</div>
            <div class="social-link-url" title="${displayUrl}">${displayUrl}</div>
          </div>
        </a>
      `;
          })
          .join("");
      }

      // Enhanced Progress Chart for user-profile.html with full animations
      class EnhancedProgressChart {
        constructor() {
          this.container = document.getElementById("progressChartContainer");
          this.wrapper = document.getElementById("progressChartWrapper");
          this.svg = document.querySelector(".progress-chart-svg");
          this.center = document.getElementById("progressChartCenter");
          this.totalElement = document.getElementById("progressTotal");
          this.labelElement = document.getElementById("progressLabel");
          this.tooltip = document.getElementById("progressTooltip");
          this.legend = document.getElementById("progressLegend");

          this.segments = new Map();
          this.legendItems = new Map();
          this.currentData = null;
          this.activeFilter = null;
          this.isAnimating = false;
          this.originalSegments = new Map();

          this.init();
        }

        async init() {
          await this.loadData();
          this.renderUnifiedChart();
          this.bindEvents();
        }

        async loadData() {
          try {
            const targetUsername = getTargetUsername();
            const token = localStorage.getItem("authToken");
            const response = await fetch(
              `${API_BASE_URL}/progress-stats/${encodeURIComponent(
                targetUsername
              )}`,
              {
                headers: {
                  Authorization: `Bearer ${token}`,
                },
              }
            );

            if (response.ok) {
              const result = await response.json();
              if (result.success) {
                this.currentData = result.stats;
                return;
              }
            }
          } catch (error) {
            console.error("Error loading progress data:", error);
          }

          // Fallback: Try to calculate from user data
          if (currentViewingUser && currentViewingUser.consistency) {
            this.currentData =
              this.calculateStatsFromUserData(currentViewingUser);
          } else {
            // Final fallback
            this.currentData = { total: 0, easy: 0, medium: 0, hard: 0 };
          }
        }

        calculateStatsFromUserData(user) {
          const totalSolved = user.statistics?.totalProblemsSolved || 0;

          // For demo purposes, distribute among difficulties
          return {
            total: totalSolved,
            easy: Math.floor(totalSolved * 0.4),
            medium: Math.floor(totalSolved * 0.4),
            hard: Math.floor(totalSolved * 0.2),
          };
        }

        // Render unified circular progress chart with animations
        renderUnifiedChart() {
          if (!this.currentData) return;

          // Clear existing segments (except total background)
          this.svg
            .querySelectorAll(".progress-circle:not(.total)")
            .forEach((segment) => segment.remove());
          this.segments.clear();
          this.originalSegments.clear();

          const total = this.currentData.total;
          if (total === 0) {
            this.showEmptyState();
            return;
          }

          // Calculate percentages
          const percentages = {
            easy: (this.currentData.easy / total) * 100,
            medium: (this.currentData.medium / total) * 100,
            hard: (this.currentData.hard / total) * 100,
          };

          // Create seamless segments in correct order (Easy -> Medium -> Hard)
          const segments = [
            { key: "easy", percentage: percentages.easy, offset: 0 },
            {
              key: "medium",
              percentage: percentages.medium,
              offset: percentages.easy,
            },
            {
              key: "hard",
              percentage: percentages.hard,
              offset: percentages.easy + percentages.medium,
            },
          ];

          segments.forEach(({ key, percentage, offset }) => {
            if (percentage === 0) return;

            const segment = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "circle"
            );
            segment.classList.add("progress-circle", key);
            segment.setAttribute("cx", "50");
            segment.setAttribute("cy", "50");
            segment.setAttribute("r", "44");
            segment.setAttribute("data-difficulty", key);
            segment.setAttribute(
              "data-count",
              this.currentData[key].toString()
            );
            segment.setAttribute("data-percentage", percentage.toFixed(1));
            segment.setAttribute("data-offset", offset.toFixed(1));
            segment.setAttribute("tabindex", "0");
            segment.setAttribute("role", "button");
            segment.setAttribute(
              "aria-label",
              `${this.capitalizeFirst(key)}: ${
                this.currentData[key]
              } problems (${percentage.toFixed(1)}%)`
            );

            // Calculate stroke dash for seamless continuous circle
            const circumference = 2 * Math.PI * 44;
            const dashLength = (percentage / 100) * circumference;
            const gapLength = circumference - dashLength;
            const dashOffset = -((offset / 100) * circumference);

            segment.style.strokeDasharray = `${dashLength} ${gapLength}`;
            segment.style.strokeDashoffset = dashOffset;
            segment.style.opacity = "1";

            // Store original values for smooth revert
            this.originalSegments.set(key, {
              dashArray: `${dashLength} ${gapLength}`,
              dashOffset: dashOffset,
              opacity: "1",
            });

            this.svg.appendChild(segment);
            this.segments.set(key, segment);

            this.addSegmentEventListeners(
              segment,
              key,
              this.currentData[key],
              percentage
            );
          });

          this.renderLegend();
          this.animateChartEntrance();
        }

        // Enhanced event listeners with better visual feedback
        addSegmentEventListeners(segment, difficulty, count, percentage) {
          const difficultyNames = {
            easy: "Easy",
            medium: "Medium",
            hard: "Hard",
          };

          segment.addEventListener("mouseenter", (e) => {
            if (this.isAnimating || this.activeFilter) return;
            this.showTooltip(e, difficultyNames[difficulty], count, percentage);
            this.highlightSegment(difficulty);

            // Add micro-interaction
            segment.style.transform = "scale(1.02)";
            segment.style.transition = "transform 0.2s ease-out";
          });

          segment.addEventListener("mouseleave", () => {
            if (this.isAnimating || this.activeFilter) return;
            this.hideTooltip();
            this.unhighlightSegments();

            // Reset micro-interaction
            segment.style.transform = "scale(1)";
          });

          segment.addEventListener("mousemove", (e) => {
            if (this.isAnimating) return;
            this.updateTooltipPosition(e);
          });

          segment.addEventListener("click", (e) => {
            e.stopPropagation();
            if (this.isAnimating) return;

            // Add click feedback
            segment.style.transform = "scale(0.98)";
            setTimeout(() => {
              segment.style.transform = "scale(1)";
            }, 150);

            this.toggleDifficultyFilter(difficulty);
          });

          segment.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              if (this.isAnimating) return;
              this.toggleDifficultyFilter(difficulty);
            }
          });
        }

        // Enhanced toggle with smooth animations
        async toggleDifficultyFilter(difficulty) {
          if (this.isAnimating) return;

          this.isAnimating = true;

          if (this.activeFilter === difficulty) {
            // Deselect - return to unified view with smooth animation
            await this.animateToUnifiedView();
            this.activeFilter = null;
          } else {
            // Select specific difficulty with premium animation
            await this.animateToDifficultyView(difficulty);
            this.activeFilter = difficulty;
          }

          this.updateActiveStates();
          this.isAnimating = false;
        }

        // Smooth animation to unified view with enhanced effects
        async animateToUnifiedView() {
          this.wrapper.classList.remove("filtered");
          this.center.classList.remove("filtered");
          this.labelElement.classList.remove("filtered");
          this.labelElement.textContent = "Total Solved";

          // Create unified view ripple
          this.createRippleEffect("total");

          // Animate count back to total
          await this.animateCount(
            parseInt(this.totalElement.textContent),
            this.currentData.total
          );

          // Smoothly revert all segments to original positions with sequenced animation
          this.segments.forEach((segment, key) => {
            const original = this.originalSegments.get(key);
            if (original) {
              const delay = key === "easy" ? 0 : key === "medium" ? 50 : 100;

              setTimeout(() => {
                segment.classList.remove("active");
                segment.style.transition =
                  "all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)";
                segment.style.strokeDasharray = original.dashArray;
                segment.style.strokeDashoffset = original.dashOffset;
                segment.style.opacity = original.opacity;
                segment.style.transform = "scale(1)";
              }, delay);
            }
          });

          // Wait for animations to complete
          await new Promise((resolve) => setTimeout(resolve, 800));
        }

        // Premium animation to difficulty view
        async animateToDifficultyView(difficulty) {
          const count = this.currentData[difficulty];
          const total = this.currentData.total;

          this.wrapper.classList.add("filtered");
          this.center.classList.add("filtered");
          this.labelElement.classList.add("filtered");
          this.labelElement.textContent = `${this.capitalizeFirst(
            difficulty
          )} Solved`;

          // Create ripple effect
          this.createRippleEffect(difficulty);

          // Animate count to filtered value
          await this.animateCount(
            parseInt(this.totalElement.textContent),
            count
          );

          // Premium animations for segments with sequenced timing
          const circumference = 2 * Math.PI * 44;

          this.segments.forEach((segment, key) => {
            segment.style.transition =
              "all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)";

            if (key === difficulty) {
              // Expand active segment to full circle with premium animation
              setTimeout(() => {
                segment.classList.add("active");
                segment.style.strokeDasharray = `${circumference} 0`;
                segment.style.strokeDashoffset = "0";
                segment.style.opacity = "1";
                segment.style.transform = "scale(1.03)";
              }, 200);
            } else {
              // Fade out other segments with staggered timing
              const delay = key === "easy" ? 100 : key === "medium" ? 150 : 200;
              setTimeout(() => {
                segment.style.opacity = "0.15";
                segment.style.transform = "scale(0.95)";
              }, delay);
            }
          });

          // Wait for animations to complete
          await new Promise((resolve) => setTimeout(resolve, 800));
        }

        // Enhanced smooth count animation with spring effect
        animateCount(from, to) {
          return new Promise((resolve) => {
            const duration = 800;
            const startTime = performance.now();
            const startValue = from;

            // Add spring animation to total element
            this.totalElement.classList.add("animating");

            const animate = (currentTime) => {
              const elapsed = currentTime - startTime;
              const progress = Math.min(elapsed / duration, 1);

              // Spring easing function for premium feel
              const springProgress =
                1 -
                Math.pow(1 - progress, 3) *
                  Math.cos(progress * Math.PI * 2) *
                  0.2;
              const currentValue = Math.floor(
                startValue + (to - startValue) * springProgress
              );

              this.totalElement.textContent = currentValue.toString();

              if (progress < 1) {
                requestAnimationFrame(animate);
              } else {
                this.totalElement.textContent = to.toString();
                setTimeout(() => {
                  this.totalElement.classList.remove("animating");
                }, 400);
                resolve();
              }
            };

            requestAnimationFrame(animate);
          });
        }

        // Update active states with visual feedback
        updateActiveStates() {
          // Update segments
          this.segments.forEach((segment, difficulty) => {
            if (difficulty === this.activeFilter) {
              segment.classList.add("active");
              segment.setAttribute("aria-pressed", "true");
            } else {
              segment.classList.remove("active");
              segment.setAttribute("aria-pressed", "false");
            }
          });

          // Update legend items with smooth transitions
          this.legendItems.forEach((item, difficulty) => {
            if (difficulty === this.activeFilter) {
              item.classList.add("active");
              item.setAttribute("aria-checked", "true");
              item.style.transform = "translateY(-2px)";
            } else {
              item.classList.remove("active");
              item.setAttribute("aria-checked", "false");
              item.style.transform = "translateY(0)";
            }
          });
        }

        // Enhanced legend rendering with click functionality
        renderLegend() {
          this.legend.innerHTML = "";
          this.legendItems.clear();

          const difficulties = [
            { key: "easy", name: "Easy", icon: "🟢" },
            { key: "medium", name: "Medium", icon: "🟡" },
            { key: "hard", name: "Hard", icon: "🔴" },
          ];

          difficulties.forEach(({ key, name, icon }) => {
            const count = this.currentData[key];
            const percentage =
              this.currentData.total > 0
                ? (count / this.currentData.total) * 100
                : 0;

            const legendItem = document.createElement("div");
            legendItem.className = "legend-item";
            legendItem.setAttribute("data-difficulty", key);
            legendItem.setAttribute("role", "radio");
            legendItem.setAttribute("aria-checked", "false");
            legendItem.setAttribute("tabindex", "0");
            legendItem.setAttribute(
              "aria-label",
              `${name}: ${count} problems solved`
            );
            legendItem.style.transition =
              "all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)";

            legendItem.innerHTML = `
        <div class="legend-color ${key}"></div>
        <div class="legend-text">
          <span class="legend-difficulty">${icon} ${name}</span>
          <span class="legend-count">${count} solved</span>
          <span class="legend-percentage">${percentage.toFixed(1)}%</span>
        </div>
      `;

            legendItem.addEventListener("click", () => {
              if (this.isAnimating) return;
              this.toggleDifficultyFilter(key);
            });

            legendItem.addEventListener("keydown", (e) => {
              if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                if (this.isAnimating) return;
                this.toggleDifficultyFilter(key);
              }
            });

            // Add hover effects
            legendItem.addEventListener("mouseenter", () => {
              if (this.isAnimating || this.activeFilter) return;
              this.highlightSegment(key);
            });

            legendItem.addEventListener("mouseleave", () => {
              if (this.isAnimating || this.activeFilter) return;
              this.unhighlightSegments();
            });

            this.legend.appendChild(legendItem);
            this.legendItems.set(key, legendItem);
          });
        }

        // Create ripple effect for interactions
        createRippleEffect(difficulty) {
          const segment = this.segments.get(difficulty);
          if (!segment) return;

          const rect = segment.getBoundingClientRect();
          const wrapperRect = this.wrapper.getBoundingClientRect();

          const ripple = document.createElement("div");
          ripple.className = "ripple";

          const size = Math.max(rect.width, rect.height) * 2;
          const x = rect.left - wrapperRect.left + rect.width / 2 - size / 2;
          const y = rect.top - wrapperRect.top + rect.height / 2 - size / 2;

          ripple.style.width = ripple.style.height = size + "px";
          ripple.style.left = x + "px";
          ripple.style.top = y + "px";

          // Set ripple color based on difficulty
          const colors = {
            easy: "rgba(45, 122, 45, 0.3)",
            medium: "rgba(179, 143, 45, 0.3)",
            hard: "rgba(196, 69, 69, 0.3)",
            total: "rgba(76, 166, 76, 0.3)",
          };

          ripple.style.background = colors[difficulty] || colors.total;

          this.wrapper.appendChild(ripple);

          // Remove ripple after animation
          setTimeout(() => {
            if (ripple.parentNode) {
              ripple.parentNode.removeChild(ripple);
            }
          }, 600);
        }

        // Enhanced chart entrance animation
        animateChartEntrance() {
          // Initial hidden state
          this.segments.forEach((segment) => {
            segment.style.opacity = "0";
            segment.style.transform = "scale(0.8) rotate(-10deg)";
          });

          this.center.style.transform = "translate(-50%, -50%) scale(0)";
          this.totalElement.style.opacity = "0";

          // Staggered entrance animation
          this.segments.forEach((segment, difficulty) => {
            const delay =
              difficulty === "easy" ? 200 : difficulty === "medium" ? 400 : 600;

            setTimeout(() => {
              segment.style.transition =
                "all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)";
              segment.style.opacity = "1";
              segment.style.transform = "scale(1) rotate(0deg)";
            }, delay);
          });

          // Center content animation
          setTimeout(() => {
            this.center.style.transition =
              "all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)";
            this.center.style.transform = "translate(-50%, -50%) scale(1)";
            this.totalElement.style.transition = "all 0.5s ease-out";
            this.totalElement.style.opacity = "1";
          }, 800);

          // Animate initial count with spring effect
          setTimeout(() => {
            this.animateCount(0, this.currentData.total);
          }, 1200);
        }

        // Show enhanced tooltip
        showTooltip(event, difficulty, count, percentage) {
          this.tooltip.innerHTML = `
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
        <strong style="color: var(--codeleaf-text-primary);">${difficulty}</strong>
      </div>
      <div style="color: var(--codeleaf-text-secondary);">${count} problems solved</div>
      <div style="color: var(--codeleaf-accent-primary); font-weight: 700; margin-top: 2px;">
        ${percentage.toFixed(1)}% of total
      </div>
    `;
          this.tooltip.classList.add("show");
          this.updateTooltipPosition(event);
        }

        // Update tooltip position
        updateTooltipPosition(event) {
          const rect = this.wrapper.getBoundingClientRect();
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;

          this.tooltip.style.left = x + "px";
          this.tooltip.style.top = y - 70 + "px";
        }

        // Hide tooltip
        hideTooltip() {
          this.tooltip.classList.remove("show");
        }

        // Highlight segment
        highlightSegment(difficulty) {
          this.segments.forEach((segment, key) => {
            if (key === difficulty) {
              segment.style.filter = "brightness(1.2)";
            } else {
              segment.style.opacity = "0.7";
            }
          });
        }

        // Unhighlight segments
        unhighlightSegments() {
          this.segments.forEach((segment) => {
            segment.style.opacity = "1";
            segment.style.filter = "";
          });
        }

        // Enhanced event binding
        bindEvents() {
          // Click outside to reset filter
          document.addEventListener("click", (e) => {
            if (
              this.activeFilter !== null &&
              !this.wrapper.contains(e.target) &&
              !this.legend.contains(e.target) &&
              !this.isAnimating
            ) {
              this.toggleDifficultyFilter(this.activeFilter);
            }
          });

          // Keyboard navigation
          this.wrapper.addEventListener("keydown", (e) => {
            if (
              e.key === "Escape" &&
              this.activeFilter !== null &&
              !this.isAnimating
            ) {
              this.toggleDifficultyFilter(this.activeFilter);
            }
          });

          // Prevent animations during resize
          window.addEventListener("resize", () => {
            this.isAnimating = true;
            setTimeout(() => {
              this.isAnimating = false;
            }, 300);
          });
        }

        // Utility function
        capitalizeFirst(string) {
          return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Show empty state
        showEmptyState() {
          this.container.innerHTML = `
      <div class="empty-state">
        <div>📊</div>
        <div>No progress data yet</div>
        <small>This user hasn't solved any problems yet</small>
      </div>
    `;
        }
      }

      // Initialize the enhanced chart
      let enhancedProgressChart;

      function initializeProgressChart() {
        enhancedProgressChart = new EnhancedProgressChart();
      }

      function showError(message) {
        const container = document.querySelector(".container");
        const errorDiv = document.createElement("div");
        errorDiv.style.cssText = `
            background: var(--codeleaf-error);
            color: white;
            padding: var(--codeleaf-space-4);
            border-radius: var(--codeleaf-radius-md);
            margin: var(--codeleaf-space-4);
            text-align: center;
            font-weight: 600;
        `;
        errorDiv.textContent = message;
        container.insertBefore(errorDiv, container.firstChild);
      }

      // Enhanced render function with all new features - FIXED for user-profile.html
      function renderUserProfile() {
        if (!currentViewingUser) return;

        const user = currentViewingUser;
        const userLevel = calculateUserLevel(user);
        const todaySolved = calculateTodaySolved(user);
        const thisWeekBlogs = calculateThisWeekBlogs(user);
        const activeDays = calculateActiveDays(user);
        const avgDaily = user.activity?.averageDaily || 0;
        const maxStreak = user.statistics?.maxStreak || 0;

        // Set avatar and level badge
        const avatarElement = document.getElementById("userAvatar");
        avatarElement.textContent = generatePixelAvatar(user.username);

        const levelBadge = document.getElementById("userLevelBadge");
        levelBadge.textContent = userLevel.level;
        levelBadge.className = `user-level-badge ${userLevel.level.toLowerCase()}`;

        // Set user name and bio
        document.getElementById("userName").textContent =
          user.username.toUpperCase();
        document.getElementById("joinDate").textContent = formatDate(
          user.accountCreated
        );

        // Update profile badge based on context
        const profileBadge = document.getElementById("profileOwnerBadge");
        if (window.location.pathname.includes("user-profile.html")) {
          profileBadge.textContent = "Viewing Profile";
        } else {
          profileBadge.textContent = "";
        }

        // Set main stats
        document.getElementById("totalSolved").textContent =
          user.statistics?.totalProblemsSolved || 0;
        document.getElementById("totalBlogs").textContent =
          user.statistics?.totalBlogsPublished || 0;
        document.getElementById("currentStreak").textContent =
          user.statistics?.currentStreak || 0;
        document.getElementById("activeDays").textContent = activeDays;

        // Set trend indicators
        document.getElementById("solvedTrend").textContent =
          todaySolved > 0 ? `+${todaySolved} today` : "+0 today";
        document.getElementById("blogsTrend").textContent =
          thisWeekBlogs > 0 ? `+${thisWeekBlogs} this week` : "+0 this week";
        document.getElementById("streakStatus").textContent = getStreakStatus(
          user.statistics?.currentStreak || 0
        );
        document.getElementById("activityTrend").textContent =
          avgDaily > 2 ? "Highly Active" : "Building Consistency";

        // Set detailed profile information
        document.getElementById("userLevel").textContent = userLevel.level;
        document.getElementById("totalXP").textContent = userLevel.xp;
        document.getElementById("avgDaily").textContent = avgDaily.toFixed(1);
        document.getElementById("maxStreak").textContent = maxStreak;
      }

      // Reuse all other functions from profile.html (make sure these are included)
      // Pixel Avatar System
      function generatePixelAvatar(username) {
        const animals = [
          "🐶",
          "🐱",
          "🐭",
          "🐹",
          "🐰",
          "🦊",
          "🐻",
          "🐼",
          "🐨",
          "🐯",
          "🦁",
          "🐮",
          "🐷",
          "🐸",
          "🐵",
        ];
        const emojis = [
          "🌟",
          "🚀",
          "💻",
          "📚",
          "🎯",
          "🔥",
          "💡",
          "⚡",
          "🎨",
          "🔮",
          "🎭",
          "🏆",
          "💎",
          "🌿",
          "🍃",
        ];
        const allOptions = [...animals, ...emojis];
        const hash = username.split("").reduce((a, b) => {
          a = (a << 5) - a + b.charCodeAt(0);
          return a & a;
        }, 0);
        const index = Math.abs(hash) % allOptions.length;
        return allOptions[index];
      }

      // Format date
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      // Format relative time
      function formatRelativeTime(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        if (diffDays === 1) return "Yesterday";
        if (diffDays < 7) return `${diffDays} days ago`;
        if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
        return formatDate(dateString);
      }

      // Load user directory - all users except current user and current viewing user
      async function loadUserDirectory() {
        const container = document.getElementById("userDirectory");
        const currentUsername = currentViewingUser?.username;
        const loggedInUsername = await getCurrentUsername();

        if (!currentUsername || !loggedInUsername) {
          container.innerHTML =
            '<div class="empty-state">Please log in to see the community</div>';
          return;
        }

        try {
          const token = localStorage.getItem("authToken");
          const response = await fetch(`${API_BASE_URL}/users`, {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load users");
          }

          const result = await response.json();

          if (result.success && result.users) {
            // Filter out current viewing user and logged in user
            const otherUsers = result.users.filter(
              (user) =>
                user.username !== currentUsername &&
                user.username !== loggedInUsername
            );
            renderUserDirectory(otherUsers, container);
          } else {
            throw new Error(result.error || "No users found");
          }
        } catch (error) {
          console.error("Error loading user directory:", error);
          // Fallback: Show message about community feature
          container.innerHTML = `
            <div class="empty-state">
                Community feature coming soon! 
                <br><small>Other users will appear here as they join.</small>
            </div>
        `;
        }
      }
      // Get current logged in username
      async function getCurrentUsername() {
        try {
          const token = localStorage.getItem("authToken");
          const response = await fetch(`${API_BASE_URL}/verify-token`, {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (response.ok) {
            const result = await response.json();
            return result.user;
          }
        } catch (error) {
          console.error("Error getting current username:", error);
        }
        return null;
      }

      // Enhanced user level calculation with single-word, positive names
      function calculateUserLevel(user) {
        const totalSolved = user.statistics?.totalProblemsSolved || 0;
        const currentStreak = user.statistics?.currentStreak || 0;
        const totalBlogs = user.statistics?.totalBlogsPublished || 0;
        const totalXP = calculateTotalXP(user);

        // Single-word, positive level names unique to FocusFlow
        if (totalXP >= 1000) return { level: "Luminary", xp: totalXP };
        if (totalXP >= 500) return { level: "Virtuoso", xp: totalXP };
        if (totalXP >= 250) return { level: "Sage", xp: totalXP };
        if (totalXP >= 100) return { level: "Explorer", xp: totalXP };
        if (totalXP >= 50) return { level: "Builder", xp: totalXP };
        if (totalXP >= 10) return { level: "Sprout", xp: totalXP };
        return { level: "Seedling", xp: totalXP };
      }

      // Calculate total XP based on various factors
      function calculateTotalXP(user) {
        const totalSolved = user.statistics?.totalProblemsSolved || 0;
        const totalBlogs = user.statistics?.totalBlogsPublished || 0;
        const currentStreak = user.statistics?.currentStreak || 0;
        const maxStreak = user.statistics?.maxStreak || 0;
        const blogLikes = user.statistics?.totalBlogLikes || 0;

        // XP calculation formula
        let xp = 0;
        xp += totalSolved * 10; // 10 XP per problem
        xp += totalBlogs * 25; // 25 XP per blog
        xp += currentStreak * 5; // 5 XP per day of current streak
        xp += maxStreak * 2; // 2 XP per day of max streak
        xp += blogLikes * 3; // 3 XP per blog like

        return Math.floor(xp);
      }

      // Calculate today's solved problems
      function calculateTodaySolved(user) {
        const today = new Date().toISOString().split("T")[0];
        const activityData = user.activity?.heatmapData || {};
        return activityData[today] || 0;
      }

      // Calculate this week's blogs
      function calculateThisWeekBlogs(user) {
        // Simple implementation - you can enhance this with actual blog dates
        const recentBlogs = user.blogs?.recentBlogs || [];
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

        return recentBlogs.filter(
          (blog) => new Date(blog.createdAt) > oneWeekAgo
        ).length;
      }

      // Calculate active days
      function calculateActiveDays(user) {
        const heatmapData = user.activity?.heatmapData || {};
        return Object.values(heatmapData).filter((count) => count > 0).length;
      }

      // Get streak status message
      function getStreakStatus(currentStreak) {
        if (currentStreak === 0) return "Start your streak!";
        if (currentStreak < 3) return "Keep going! 💪";
        if (currentStreak < 7) return "Building momentum! 🔥";
        if (currentStreak < 14) return "On fire! 🌟";
        if (currentStreak < 30) return "Unstoppable! ⚡";
        return "Legendary streak! 🏆";
      }

      // Render user directory (same as profile.html)
      function renderUserDirectory(users, container) {
        if (!users || users.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
                No other users yet 
                <br><small>Be the first to invite friends to join!</small>
            </div>
        `;
          return;
        }

        container.innerHTML = users
          .map(
            (user) => `
            <div class="user-item" onclick="viewUserProfile('${
              user.username
            }')">
                <div class="user-avatar">${generateUserAvatar(
                  user.username
                )}</div>
                <div class="user-details">
                    <div class="user-name">${escapeHtml(
                      user.username.toUpperCase()
                    )}</div>
                    <div class="user-stats">
                        <span class="user-stat">${
                          user.totalSolved || 0
                        } solved</span>
                        <span class="user-stat">${
                          user.totalBlogs || 0
                        } blogs</span>
                        <span class="user-stat">${
                          user.currentStreak || 0
                        } day streak</span>
                    </div>
                </div>
                <div class="user-action">View Profile →</div>
            </div>
        `
          )
          .join("");
      }

      // Generate consistent avatar for any user (same as profile.html)
      // Enhanced avatar system - unique, thematic, and expressive
      function generateUserAvatar(username) {
        // Theme-based avatar collections
        const codingThemed = [
          "💻",
          "🔍",
          "⚡",
          "🔧",
          "🚀",
          "🎯",
          "💡",
          "🔮",
          "📱",
          "💾",
          "📊",
          "🔒",
          "🎮",
          "🌐",
          "🛠️",
          "📐",
        ];

        const natureThemed = [
          "🌱",
          "🍃",
          "🌿",
          "☘️",
          "🎍",
          "🌴",
          "🌲",
          "🌳",
          "🌺",
          "🌸",
          "🌼",
          "🌻",
          "🍀",
          "🎋",
          "🪴",
          "🌵",
        ];

        const animalThemed = [
          "🐶",
          "🐱",
          "🐭",
          "🐹",
          "🐰",
          "🦊",
          "🐻",
          "🐼",
          "🐨",
          "🐯",
          "🦁",
          "🐮",
          "🐷",
          "🐸",
          "🐵",
          "🦄",
        ];

        const creativeThemed = [
          "🎨",
          "✏️",
          "📝",
          "🎭",
          "🎪",
          "🎼",
          "🎹",
          "🎸",
          "🎺",
          "🥁",
          "🎬",
          "📷",
          "🎮",
          "🧩",
          "🔭",
          "📚",
        ];

        const wisdomThemed = [
          "🌟",
          "⭐",
          "✨",
          "🔭",
          "📖",
          "🎓",
          "🧠",
          "💎",
          "🏆",
          "🎖️",
          "👑",
          "💫",
          "🌠",
          "🪐",
          "🚀",
          "🔬",
        ];

        // Combine all themes
        const allAvatars = [
          ...codingThemed,
          ...natureThemed,
          ...animalThemed,
          ...creativeThemed,
          ...wisdomThemed,
        ];

        // Generate consistent hash from username
        const hash = username.split("").reduce((a, b) => {
          a = (a << 5) - a + b.charCodeAt(0);
          return a & a;
        }, 0);

        // Select avatar based on hash
        const avatarIndex = Math.abs(hash) % allAvatars.length;

        return allAvatars[avatarIndex];
      }

      // Enhanced pixel avatar generation for profile header
      function generatePixelAvatar(username) {
        // Specialized collection for larger profile avatars
        const profileAvatars = [
          "👨‍💻",
          "👩‍💻",
          "🧙‍♂️",
          "🧙‍♀️",
          "🦊",
          "🐱",
          "🐼",
          "🐨",
          "🦁",
          "🐯",
          "🐉",
          "🦄",
          "🌟",
          "🚀",
          "🎯",
          "💎",
          "🔮",
          "⚡",
          "🔥",
          "🌙",
          "☀️",
          "🌈",
          "🌊",
          "🌳",
          "🎨",
          "📚",
          "🔧",
          "🎭",
          "👑",
          "🛡️",
          "🗝️",
          "💡",
        ];

        const hash = username.split("").reduce((a, b) => {
          a = (a << 5) - a + b.charCodeAt(0);
          return a & a;
        }, 0);

        const avatarIndex = Math.abs(hash) % profileAvatars.length;
        return profileAvatars[avatarIndex];
      }
      // View user profile - opens in new page (same as profile.html)
      function viewUserProfile(username) {
        // Navigate to profile page with user parameter
        window.location.href = `/user-profile.html?user=${encodeURIComponent(
          username
        )}`;
      }

      function renderAchievements() {
        const grid = document.getElementById("achievementsGrid");
        const userData = currentViewingUser;

        if (!userData) return;

        const achievements = calculateAchievements(userData);

        if (achievements.length === 0) {
          grid.innerHTML =
            '<div class="empty-state">No achievements yet. Start coding to earn your first achievement!</div>';
          return;
        }

        grid.innerHTML = achievements
          .map((achievement) => {
            const tooltipText = getAchievementTooltip(achievement);
            const progressBar =
              !achievement.unlocked && achievement.progress > 0
                ? `<div class="achievement-progress">
             <div class="achievement-progress-bar" style="width: ${achievement.progress}%"></div>
           </div>`
                : "";

            // Round progress to whole number for display
            const roundedProgress = Math.round(achievement.progress);
            return `
          <div class="achievement-card ${
            achievement.unlocked ? "unlocked" : ""
          }">
              <div class="achievement-lock">🔒</div>
              <div class="achievement-icon">${achievement.icon}</div>
              <div class="achievement-title">${achievement.title}</div>
              ${progressBar}
              <div class="achievement-tooltip">
                  <strong>${achievement.title}</strong><br>
                  ${tooltipText}
                  ${
                    !achievement.unlocked
                      ? `<br><small>Progress: ${roundedProgress}%</small>`
                      : ""
                  }
              </div>
          </div>
      `;
          })
          .join("");
      }

      // Helper function to get achievement tooltip text
      function getAchievementTooltip(achievement) {
        const tooltips = {
          "First Steps":
            "Solve your very first coding problem to unlock this achievement",
          "Problem Solver":
            "Reach 50 problems solved to become a reliable problem solver",
          "Code Master":
            "Achieve mastery by solving 100 problems across various topics",
          Blogger:
            "Share your knowledge by writing and publishing your first blog post",
          "Content Creator":
            "Become a content creator by publishing 5 helpful blogs",
          "Consistency King":
            "Maintain a 7-day coding streak to build strong habits",
          "Dedicated Learner":
            "Show incredible dedication with a 30-day coding streak",
          "Community Star":
            "Get 10 likes on your blogs to become a community favorite",
        };
        return tooltips[achievement.title] || achievement.description;
      }

      function calculateAchievements(user) {
        const totalSolved = user.statistics?.totalProblemsSolved || 0;
        const totalBlogs = user.statistics?.totalBlogsPublished || 0;
        const currentStreak = user.statistics?.currentStreak || 0;
        const maxStreak = user.statistics?.maxStreak || 0;
        const blogLikes = user.statistics?.totalBlogLikes || 0;

        return [
          {
            icon: "🚀",
            title: "First Steps",
            description: "Solve your first problem",
            unlocked: totalSolved >= 1,
            progress: Math.min((totalSolved / 1) * 100, 100),
          },
          {
            icon: "💪",
            title: "Problem Solver",
            description: "Solve 50 problems",
            unlocked: totalSolved >= 50,
            progress: Math.min((totalSolved / 50) * 100, 100),
          },
          {
            icon: "🏆",
            title: "Code Master",
            description: "Solve 100 problems",
            unlocked: totalSolved >= 100,
            progress: Math.min((totalSolved / 100) * 100, 100),
          },
          {
            icon: "✍️",
            title: "Blogger",
            description: "Write your first blog",
            unlocked: totalBlogs >= 1,
            progress: Math.min((totalBlogs / 1) * 100, 100),
          },
          {
            icon: "📝",
            title: "Content Creator",
            description: "Write 5 blogs",
            unlocked: totalBlogs >= 5,
            progress: Math.min((totalBlogs / 5) * 100, 100),
          },
          {
            icon: "🔥",
            title: "Consistency King",
            description: "Maintain a 7-day streak",
            unlocked: currentStreak >= 7,
            progress: Math.min((currentStreak / 7) * 100, 100),
          },
          {
            icon: "⚡",
            title: "Dedicated Learner",
            description: "Maintain a 30-day streak",
            unlocked: currentStreak >= 30,
            progress: Math.min((currentStreak / 30) * 100, 100),
          },
          {
            icon: "🌟",
            title: "Community Star",
            description: "Get 10 blog likes",
            unlocked: blogLikes >= 10,
            progress: Math.min((blogLikes / 10) * 100, 100),
          },
        ];
      }
      // Render question history with expandable days (same as profile.html)
      function renderQuestionHistory() {
        const container = document.getElementById("questionHistory");
        if (!currentViewingUser) return;

        const questions = currentViewingUser.questions?.dailyProgress || [];
        const solvedQuestions = questions
          .flatMap((day) =>
            day.completedQuestions > 0
              ? [
                  {
                    day: day.day,
                    date: day.date,
                    solved: day.completedQuestions,
                    total: day.totalQuestions,
                    questions: day.questions || [], // Use the actual questions data
                  },
                ]
              : []
          )
          .reverse()
          .slice(0, 10); // Show last 10 days with activity

        if (solvedQuestions.length === 0) {
          container.innerHTML =
            '<div class="empty-state">No questions solved yet.</div>';
          return;
        }

        container.innerHTML = solvedQuestions
          .map(
            (day) => `
            <div class="content-item question-day" data-day="${day.day}">
                <div class="question-day-header">
                    <div class="question-day-info">
                        <div class="question-title">Day ${
                          day.day
                        } Progress</div>
                        <div class="question-date">${
                          day.date ? formatDate(day.date) : `Day ${day.day}`
                        }</div>
                    </div>
                    <div class="question-day-stats">
                        <span class="question-count">${day.solved}/${
              day.total
            } solved</span>
                        ${
                          day.questions && day.questions.length > 0
                            ? `
                            <button class="toggle-day-btn" onclick="toggleDayDetails(${day.day})" aria-label="Toggle day details">
                                <span class="toggle-icon">▼</span>
                            </button>
                        `
                            : ""
                        }
                    </div>
                </div>
                ${
                  day.questions && day.questions.length > 0
                    ? `
                    <div class="question-day-details" id="day-${
                      day.day
                    }-details" style="display: none;">
                        <div class="solved-questions-list">
                            ${renderDayQuestions(day.questions)}
                        </div>
                    </div>
                `
                    : ""
                }
            </div>
        `
          )
          .join("");
      }

      // Render individual questions for a day
      function renderDayQuestions(questions) {
        if (!questions || questions.length === 0) {
          return '<div class="empty-day-state">No questions solved this day</div>';
        }

        return questions
          .map(
            (question, index) => `
            <div class="solved-question-item" style="animation-delay: ${
              index * 0.05
            }s">
                <div class="question-text">${escapeHtml(question.text)}</div>
                ${
                  question.link
                    ? `
                    <a href="${
                      question.link
                    }" target="_blank" rel="noopener noreferrer" class="question-action-link">
                        ${
                          question.link.includes("leetcode.com")
                            ? "Solve this"
                            : "See this question"
                        } →
                    </a>
                `
                    : ""
                }
            </div>
        `
          )
          .join("");
      }

      // Toggle day details with smooth animation
      function toggleDayDetails(dayNumber) {
        const detailsElement = document.getElementById(
          `day-${dayNumber}-details`
        );
        const toggleIcon = document.querySelector(
          `[onclick="toggleDayDetails(${dayNumber})"] .toggle-icon`
        );
        const dayElement = document.querySelector(`[data-day="${dayNumber}"]`);

        if (!detailsElement || !toggleIcon || !dayElement) return;

        // Check if we're opening or closing
        const isOpening = detailsElement.style.display === "none";

        // Close all other open days first (if opening a new one)
        if (isOpening) {
          closeAllOtherDays(dayNumber);
        }

        if (isOpening) {
          // Expand with smooth animation
          detailsElement.style.display = "block";
          // Small delay to ensure display change is processed
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              detailsElement.style.opacity = "1";
              detailsElement.style.transform = "translateY(0)";
              toggleIcon.style.transform = "rotate(180deg)";
              dayElement.classList.add("expanded");
            });
          });
        } else {
          // Collapse with smooth animation
          detailsElement.style.opacity = "0";
          detailsElement.style.transform = "translateY(-10px)";
          toggleIcon.style.transform = "rotate(0deg)";
          dayElement.classList.remove("expanded");

          setTimeout(() => {
            detailsElement.style.display = "none";
          }, 300);
        }
      }

      // Close all other open days except the specified one
      function closeAllOtherDays(exceptDayNumber) {
        document
          .querySelectorAll(".question-day.expanded")
          .forEach((dayElement) => {
            const dayNum = parseInt(dayElement.dataset.day);
            if (dayNum !== exceptDayNumber) {
              const otherDetails = document.getElementById(
                `day-${dayNum}-details`
              );
              const otherToggleIcon = document.querySelector(
                `[onclick="toggleDayDetails(${dayNum})"] .toggle-icon`
              );

              if (otherDetails && otherToggleIcon) {
                // Animate collapse
                otherDetails.style.opacity = "0";
                otherDetails.style.transform = "translateY(-10px)";
                otherToggleIcon.style.transform = "rotate(0deg)";
                dayElement.classList.remove("expanded");

                setTimeout(() => {
                  otherDetails.style.display = "none";
                }, 300);
              }
            }
          });
      }

      // Enhanced keyboard navigation support
      function enhanceKeyboardNavigation() {
        document.addEventListener("keydown", function (event) {
          // Close all dropdowns when Escape is pressed
          if (event.key === "Escape") {
            closeAllOtherDays(-1); // Close all days
          }

          // Support arrow key navigation between days
          if (event.key === "ArrowDown" || event.key === "ArrowUp") {
            const focusedElement = document.activeElement;
            if (
              focusedElement &&
              focusedElement.classList.contains("toggle-day-btn")
            ) {
              event.preventDefault();
              navigateDays(event.key === "ArrowDown" ? 1 : -1, focusedElement);
            }
          }
        });
      }

      // Navigate between days with arrow keys
      function navigateDays(direction, currentButton) {
        const allDayButtons = Array.from(
          document.querySelectorAll(".toggle-day-btn")
        );
        const currentIndex = allDayButtons.indexOf(currentButton);
        const nextIndex =
          (currentIndex + direction + allDayButtons.length) %
          allDayButtons.length;

        if (allDayButtons[nextIndex]) {
          allDayButtons[nextIndex].focus();
        }
      }

      // Initialize keyboard navigation when DOM is loaded
      document.addEventListener("DOMContentLoaded", function () {
        enhanceKeyboardNavigation();
      });

      // Render blogs (only public blogs for other users)
      function renderBlogs() {
        const container = document.getElementById("blogsContent");
        if (!currentViewingUser) return;

        const blogs = currentViewingUser.blogs?.recentBlogs || [];

        if (blogs.length === 0) {
          container.innerHTML =
            '<div class="empty-state">No public blogs yet.</div>';
          return;
        }

        container.innerHTML = blogs
          .map(
            (blog) => `
                    <div class="content-item blog-item">
                        <div class="blog-info">
                            <div class="blog-title">${escapeHtml(
                              blog.title
                            )}</div>
                            <div class="blog-date">${formatRelativeTime(
                              blog.createdAt
                            )} • ${blog.views || 0} views • ${
              blog.likes || 0
            } likes</div>
                        </div>
                        <a href="/blogs/${
                          blog.slug
                        }" class="blog-link">Read →</a>
                    </div>
                `
          )
          .join("");
      }

      // Render consistency map
      function renderConsistencyMap() {
        const heatmapGrid = document.getElementById("heatmapGrid");
        const monthsRow = document.getElementById("heatmapMonths");
        if (!currentViewingUser) return;
        const heatmapData = currentViewingUser.activity?.heatmapData || {};
        renderHeatmap(heatmapData, heatmapGrid, monthsRow);
      }

      // Heatmap rendering function
      function renderHeatmap(activityData, heatmapGrid, monthsRow) {
        heatmapGrid.innerHTML = "";
        monthsRow.innerHTML = "";
        const startDate = new Date("2025-09-25");
        const today = new Date();
        const monthLabels = generateMonthLabels(startDate, today);
        monthLabels.forEach((month) => {
          const monthLabel = document.createElement("div");
          monthLabel.className = "month-label";
          monthLabel.textContent = month;
          monthsRow.appendChild(monthLabel);
        });
        let currentDate = new Date(startDate);
        const cells = [];
        for (let week = 0; week < 52; week++) {
          for (let day = 0; day < 7; day++) {
            const dateKey = formatDateKey(currentDate);
            const activityCount = activityData[dateKey] || 0;
            const activityLevel = getActivityLevel(activityCount);
            const cell = document.createElement("div");
            cell.className = `heatmap-cell level-${activityLevel}`;
            cell.setAttribute(
              "title",
              `${formatDisplayDate(
                currentDate
              )}: ${activityCount} problems solved`
            );
            cells.push(cell);
            currentDate.setDate(currentDate.getDate() + 1);
            if (currentDate > today) break;
          }
          if (currentDate > today) break;
        }
        cells.forEach((cell) => {
          heatmapGrid.appendChild(cell);
        });
      }

      // Helper functions for heatmap
      function formatDateKey(date) {
        return date.toISOString().split("T")[0];
      }

      function formatDisplayDate(date) {
        return date.toLocaleDateString("en-US", {
          weekday: "short",
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      function getActivityLevel(count) {
        if (count === 0) return 0;
        if (count === 1) return 1;
        if (count === 2) return 2;
        if (count === 3) return 3;
        return 4;
      }

      function generateMonthLabels(startDate, endDate) {
        const labels = [];
        const currentDate = new Date(startDate);
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        while (currentDate <= endDate) {
          if (
            currentDate.getDate() <= 7 ||
            currentDate.getTime() === startDate.getTime()
          ) {
            labels.push(months[currentDate.getMonth()]);
          } else {
            labels.push("");
          }
          currentDate.setDate(currentDate.getDate() + 7);
        }
        return labels.slice(0, 52);
      }

      // Render progress bars
      function renderProgressBars() {
        const container = document.getElementById("progressBars");
        if (!currentViewingUser) return;
        const user = currentViewingUser;
        const totalSolved = user.statistics?.totalProblemsSolved || 0;
        const totalBlogs = user.statistics?.totalBlogsPublished || 0;
        const blogLikes = user.statistics?.totalBlogLikes || 0;
        const blogViews = user.statistics?.totalBlogViews || 0;
        container.innerHTML = `
            <div class="progress-item">
                <div class="progress-header">
                    <span class="progress-label">Problems Solved</span>
                    <span class="progress-value">${totalSolved}</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${Math.min(
                      (totalSolved / 100) * 100,
                      100
                    )}%"></div>
                </div>
            </div>
            <div class="progress-item">
                <div class="progress-header">
                    <span class="progress-label">Blogs Published</span>
                    <span class="progress-value">${totalBlogs}</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${Math.min(
                      (totalBlogs / 10) * 100,
                      100
                    )}%"></div>
                </div>
            </div>
            <div class="progress-item">
                <div class="progress-header">
                    <span class="progress-label">Blog Engagement</span>
                    <span class="progress-value">${blogLikes} likes</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${Math.min(
                      (blogLikes / 50) * 100,
                      100
                    )}%"></div>
                </div>
            </div>
            <div class="progress-item">
                <div class="progress-header">
                    <span class="progress-label">Knowledge Shared</span>
                    <span class="progress-value">${blogViews} views</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${Math.min(
                      (blogViews / 100) * 100,
                      100
                    )}%"></div>
                </div>
            </div>
        `;
      }

      // Utility function to escape HTML
      function escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", function () {
        const token = localStorage.getItem("authToken");
        if (!token) {
          window.location.href = "/index.html";
          return;
        }
        loadUserProfile();
      });

      // Add responsive behavior for the heatmap
      window.addEventListener("resize", function () {
        if (currentViewingUser) {
          renderConsistencyMap();
        }
      });
    </script>
  </body>
</html>
