<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/FocusFlow.ico" />
    <link rel="stylesheet" href="/responsive.css" />
    <title>Profile - FocusFlow</title>
    <style>
      /* CodeLeaf Theme Variables - Consistent with existing system */
      :root {
        --codeleaf-bg-primary: #f8fbf8;
        --codeleaf-bg-secondary: #f1f8f1;
        --codeleaf-bg-tertiary: #eaf5ea;
        --codeleaf-text-primary: #1a3a1a;
        --codeleaf-text-secondary: #4a674a;
        --codeleaf-text-tertiary: #6b856b;
        --codeleaf-accent-primary: #2d7a2d;
        --codeleaf-accent-secondary: #4ca64c;
        --codeleaf-accent-muted: #a8d4a8;
        --codeleaf-border-light: #e0ede0;
        --codeleaf-border-medium: #c8e0c8;
        --codeleaf-success: #2d7a2d;
        --codeleaf-warning: #b38f2d;
        --codeleaf-error: #c44545;
        --codeleaf-info: #2d6b7a;

        /* Fluid Typography */
        --codeleaf-font-xs: clamp(0.7rem, 2vw, 0.75rem);
        --codeleaf-font-sm: clamp(0.8rem, 2.5vw, 0.875rem);
        --codeleaf-font-base: clamp(0.9rem, 3vw, 1rem);
        --codeleaf-font-lg: clamp(1rem, 3.5vw, 1.125rem);
        --codeleaf-font-xl: clamp(1.125rem, 4vw, 1.25rem);
        --codeleaf-font-2xl: clamp(1.25rem, 5vw, 1.5rem);
        --codeleaf-font-3xl: clamp(1.5rem, 6vw, 1.875rem);

        /* Fluid Spacing */
        --codeleaf-space-1: clamp(0.125rem, 1vw, 0.25rem);
        --codeleaf-space-2: clamp(0.25rem, 1.5vw, 0.5rem);
        --codeleaf-space-3: clamp(0.375rem, 2vw, 0.75rem);
        --codeleaf-space-4: clamp(0.5rem, 2.5vw, 1rem);
        --codeleaf-space-6: clamp(0.75rem, 3vw, 1.5rem);
        --codeleaf-space-8: clamp(1rem, 4vw, 2rem);

        /* Border Radius */
        --codeleaf-radius-sm: 4px;
        --codeleaf-radius-md: 6px;
        --codeleaf-radius-lg: 8px;

        /* Shadows */
        --codeleaf-shadow-sm: 0 1px 2px rgba(45, 122, 45, 0.04);
        --codeleaf-shadow-md: 0 2px 8px rgba(45, 122, 45, 0.08);
        --codeleaf-shadow-lg: 0 4px 16px rgba(45, 122, 45, 0.12);
      }

      /* Dark mode support */
      @media (prefers-color-scheme: dark) {
        :root {
          --codeleaf-bg-primary: #0a1a0a;
          --codeleaf-bg-secondary: #0f230f;
          --codeleaf-bg-tertiary: #142d14;
          --codeleaf-text-primary: #e8f5e8;
          --codeleaf-text-secondary: #b8d4b8;
          --codeleaf-text-tertiary: #88a488;
          --codeleaf-accent-primary: #4ca64c;
          --codeleaf-accent-secondary: #5cb85c;
          --codeleaf-accent-muted: #2d5a2d;
          --codeleaf-border-light: #1a3a1a;
          --codeleaf-border-medium: #2d4a2d;
        }
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
      }

      body {
        background-color: var(--codeleaf-bg-primary);
        color: var(--codeleaf-text-primary);
        line-height: 1.6;
        padding: var(--codeleaf-space-4);
        transition: background-color 0.3s, color 0.3s;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      /* Header Styles - Consistent with existing pages */
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--codeleaf-space-6);
        padding-bottom: var(--codeleaf-space-4);
        border-bottom: 1px solid var(--codeleaf-border-light);
      }

      h1 {
        font-size: var(--codeleaf-font-2xl);
        color: var(--codeleaf-accent-primary);
        font-weight: 700;
      }

      .nav-links {
        display: flex;
        gap: var(--codeleaf-space-4);
        align-items: center;
      }

      .nav-link {
        color: var(--codeleaf-text-secondary);
        text-decoration: none;
        padding: var(--codeleaf-space-2) var(--codeleaf-space-4);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.2s ease;
        border: 1px solid var(--codeleaf-border-light);
        background: var(--codeleaf-bg-primary);
        font-size: var(--codeleaf-font-sm);
      }

      .nav-link:hover {
        background: var(--codeleaf-bg-tertiary);
        border-color: var(--codeleaf-accent-muted);
        color: var(--codeleaf-accent-primary);
        transform: translateY(-1px);
      }

      .nav-link.active {
        background: var(--codeleaf-accent-primary);
        color: white;
        border-color: var(--codeleaf-accent-primary);
      }

      /* Main Layout - 70/30 split like index.html */
      .main-container {
        display: flex;
        gap: var(--codeleaf-space-8);
        align-items: flex-start;
      }

      .left-column {
        flex: 0 0 70%;
        width: 70%;
      }

      .right-column {
        flex: 0 0 30%;
        width: 30%;
        display: flex;
        flex-direction: column;
        gap: var(--codeleaf-space-6);
      }

      /* Profile Header Section */
      .profile-header {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        margin-bottom: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
        display: flex;
        gap: var(--codeleaf-space-6);
        align-items: center;
      }

      .avatar-container {
        position: relative;
        flex-shrink: 0;
      }

      .pixel-avatar {
        width: 120px;
        height: 120px;
        border-radius: var(--codeleaf-radius-lg);
        background: linear-gradient(
          135deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: white;
        box-shadow: var(--codeleaf-shadow-md);
        border: 4px solid var(--codeleaf-bg-primary);
        outline: 1px solid var(--codeleaf-border-light);
      }

      .profile-info {
        flex: 1;
      }

      .profile-name {
        font-size: var(--codeleaf-font-2xl);
        color: var(--codeleaf-accent-primary);
        margin-bottom: var(--codeleaf-space-2);
        font-weight: 700;
      }

      .profile-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: var(--codeleaf-space-4);
        margin-top: var(--codeleaf-space-4);
      }

      .stat-item {
        text-align: center;
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-secondary);
        border-radius: var(--codeleaf-radius-md);
        border: 1px solid var(--codeleaf-border-light);
      }

      .stat-value {
        font-size: var(--codeleaf-font-xl);
        font-weight: 700;
        color: var(--codeleaf-accent-primary);
        margin-bottom: var(--codeleaf-space-1);
      }

      .stat-label {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Achievements Section */
      .achievements-section {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        margin-bottom: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .section-title {
        font-size: var(--codeleaf-font-xl);
        color: var(--codeleaf-accent-primary);
        margin-bottom: var(--codeleaf-space-4);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-2);
      }

      /* Enhanced Achievements Section */
      .achievements-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: var(--codeleaf-space-3);
      }

      .achievement-card {
        background: var(--codeleaf-bg-secondary);
        border: 2px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-3);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        text-align: center;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: var(--codeleaf-space-2);
      }

      /* Subtle unlocked state */
      .achievement-card.unlocked {
        background: var(--codeleaf-bg-primary);
        border-color: var(--codeleaf-accent-muted);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      /* Locked state - more subtle */
      .achievement-card:not(.unlocked) {
        background: var(--codeleaf-bg-secondary);
        border-color: var(--codeleaf-border-light);
        opacity: 0.7;
      }

      .achievement-card:not(.unlocked):hover {
        opacity: 0.9;
        transform: translateY(-2px);
      }

      .achievement-card.unlocked:hover {
        border-color: var(--codeleaf-accent-primary);
        transform: translateY(-2px);
        box-shadow: var(--codeleaf-shadow-md);
      }

      .achievement-icon {
        font-size: 2rem;
        margin-bottom: 0;
        transition: transform 0.3s ease;
      }

      .achievement-card:hover .achievement-icon {
        transform: scale(1.1);
      }

      .achievement-title {
        font-weight: 600;
        color: var(--codeleaf-text-primary);
        margin-bottom: 0;
        font-size: var(--codeleaf-font-sm);
        line-height: 1.2;
      }

      .achievement-card:not(.unlocked) .achievement-title {
        color: var(--codeleaf-text-tertiary);
      }

      .achievement-desc {
        display: none; /* Hide description by default */
      }

      .achievement-progress {
        margin-top: var(--codeleaf-space-2);
        height: 4px;
        background: var(--codeleaf-border-light);
        border-radius: 2px;
        overflow: hidden;
        width: 100%;
      }

      .achievement-progress-bar {
        height: 100%;
        background: var(--codeleaf-accent-primary);
        border-radius: 2px;
        transition: width 0.3s ease;
      }

      /* Grayscale effect for locked achievements */
      .achievement-card:not(.unlocked) {
        filter: grayscale(0.9) brightness(0.95);
        background: var(--codeleaf-bg-secondary);
        border-color: var(--codeleaf-border-light);
        opacity: 0.8;
      }

      .achievement-card:not(.unlocked):hover {
        filter: grayscale(0.7) brightness(1);
        opacity: 0.9;
        transform: translateY(-2px);
      }

      .achievement-card:not(.unlocked) .achievement-icon {
        filter: grayscale(1) brightness(0.8);
      }

      .achievement-card:not(.unlocked):hover .achievement-icon {
        filter: grayscale(0.6) brightness(0.9);
      }

      .achievement-card:not(.unlocked) .achievement-title {
        color: var(--codeleaf-text-tertiary);
      }

      /* Tooltip for achievements */
      .achievement-tooltip {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(-8px);
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-3);
        box-shadow: var(--codeleaf-shadow-lg);
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
        white-space: nowrap;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: none;
      }

      .achievement-tooltip::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: var(--codeleaf-bg-primary);
      }

      .achievement-card:hover .achievement-tooltip {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(-12px);
      }

      /* Lock icon for locked achievements */
      .achievement-lock {
        position: absolute;
        top: 8px;
        right: 8px;
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-tertiary);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .achievement-card:not(.unlocked) .achievement-lock {
        opacity: 1;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .achievements-grid {
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
          gap: var(--codeleaf-space-2);
        }

        .achievement-card {
          min-height: 100px;
          padding: var(--codeleaf-space-2);
        }

        .achievement-icon {
          font-size: 1.5rem;
        }

        .achievement-title {
          font-size: var(--codeleaf-font-xs);
        }
      }

      @media (max-width: 480px) {
        .achievements-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .achievement-tooltip {
          white-space: normal;
          width: 160px;
          text-align: center;
        }
      }

      /* Content Sections */
      .content-section {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        margin-bottom: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .content-grid {
        display: grid;
        gap: var(--codeleaf-space-4);
      }

      .content-item {
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-4);
        transition: all 0.2s ease;
      }

      .content-item:hover {
        border-color: var(--codeleaf-accent-muted);
        transform: translateY(-1px);
      }

      .question-item,
      .blog-item {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--codeleaf-space-3);
      }

      .question-info,
      .blog-info {
        flex: 1;
      }

      .question-title,
      .blog-title {
        font-weight: 600;
        color: var(--codeleaf-text-primary);
        margin-bottom: var(--codeleaf-space-1);
        line-height: 1.3;
      }

      .question-date,
      .blog-date {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
      }

      .question-link,
      .blog-link {
        color: var(--codeleaf-accent-primary);
        text-decoration: none;
        font-size: var(--codeleaf-font-sm);
        padding: var(--codeleaf-space-1) var(--codeleaf-space-2);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-sm);
        transition: all 0.2s ease;
      }

      .question-link:hover,
      .blog-link:hover {
        background: var(--codeleaf-accent-primary);
        color: white;
        border-color: var(--codeleaf-accent-primary);
      }

      /* User Directory */
      .user-directory {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .user-grid {
        display: grid;
        gap: var(--codeleaf-space-3);
        max-height: 400px;
        overflow-y: auto;
      }

      .user-item {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.2s ease;
      }

      .user-item:hover {
        border-color: var(--codeleaf-accent-muted);
        transform: translateX(4px);
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: var(--codeleaf-font-sm);
        font-weight: 600;
        flex-shrink: 0;
      }

      .user-details {
        flex: 1;
      }

      .user-name {
        font-weight: 600;
        color: var(--codeleaf-text-primary);
        margin-bottom: 2px;
      }

      .user-stats {
        display: flex;
        gap: var(--codeleaf-space-3);
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
      }

      .user-stat {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      /* Consistency Map - Mirror from index.html */
      .consistency-map {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .heatmap-container {
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-4);
      }

      .heatmap-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--codeleaf-space-4);
      }

      .heatmap-title {
        font-size: var(--codeleaf-font-lg);
        color: var(--codeleaf-text-primary);
        font-weight: 600;
      }

      .heatmap-legend {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-2);
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
      }

      .legend-colors {
        display: flex;
        gap: 2px;
      }

      .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 2px;
      }

      .legend-color.level-0 {
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
      }
      .legend-color.level-1 {
        background-color: #9be9a8;
      }
      .legend-color.level-2 {
        background-color: #40c463;
      }
      .legend-color.level-3 {
        background-color: #30a14e;
      }
      .legend-color.level-4 {
        background-color: #216e39;
      }

      .heatmap-content {
        display: flex;
        gap: var(--codeleaf-space-3);
      }

      .months-row {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding-top: 24px;
        width: 40px;
        flex-shrink: 0;
      }

      .month-label {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        height: 12px;
        text-align: right;
        padding-right: var(--codeleaf-space-2);
      }

      .heatmap-grid {
        display: grid;
        grid-template-columns: repeat(52, 12px);
        grid-auto-rows: 12px;
        gap: 3px;
        flex: 1;
      }

      .heatmap-cell {
        width: 12px;
        height: 12px;
        border-radius: 2px;
        cursor: pointer;
        transition: transform 0.1s ease;
      }

      .heatmap-cell:hover {
        transform: scale(1.3);
        z-index: 2;
      }

      .heatmap-cell.level-0 {
        background-color: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
      }
      .heatmap-cell.level-1 {
        background-color: #9be9a8;
      }
      .heatmap-cell.level-2 {
        background-color: #40c463;
      }
      .heatmap-cell.level-3 {
        background-color: #30a14e;
      }
      .heatmap-cell.level-4 {
        background-color: #216e39;
      }

      /* Progress Visualization */
      .progress-section {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .progress-bars {
        display: flex;
        flex-direction: column;
        gap: var(--codeleaf-space-4);
      }

      .progress-item {
        display: flex;
        flex-direction: column;
        gap: var(--codeleaf-space-2);
      }

      .progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .progress-label {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
        font-weight: 500;
      }

      .progress-value {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-accent-primary);
        font-weight: 600;
      }

      .progress-bar {
        height: 8px;
        background: var(--codeleaf-border-light);
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        border-radius: 4px;
        transition: width 0.8s ease;
      }

      /* Responsive Design */
      @media (max-width: 1200px) {
        .main-container {
          flex-direction: column;
        }

        .left-column,
        .right-column {
          flex: 1;
          width: 100%;
        }
      }

      @media (max-width: 768px) {
        .profile-header {
          flex-direction: column;
          text-align: center;
          gap: var(--codeleaf-space-4);
        }

        .profile-stats {
          grid-template-columns: repeat(2, 1fr);
        }

        .achievements-grid {
          grid-template-columns: 1fr;
        }

        .heatmap-grid {
          grid-template-columns: repeat(26, 10px);
          gap: 2px;
        }

        .heatmap-cell {
          width: 10px;
          height: 10px;
        }

        .months-row {
          width: 30px;
          padding-top: 20px;
        }

        .month-label {
          font-size: 0.6rem;
          height: 10px;
        }
      }

      @media (max-width: 480px) {
        .profile-stats {
          grid-template-columns: 1fr;
        }

        .heatmap-grid {
          grid-template-columns: repeat(13, 8px);
          gap: 1px;
        }

        .heatmap-cell {
          width: 8px;
          height: 8px;
        }

        .months-row {
          width: 25px;
          padding-top: 16px;
        }

        .month-label {
          font-size: 0.5rem;
          height: 8px;
        }

        .question-item,
        .blog-item {
          flex-direction: column;
          gap: var(--codeleaf-space-2);
        }

        .question-link,
        .blog-link {
          align-self: flex-start;
        }
      }

      /* Loading States */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: var(--codeleaf-space-8);
        color: var(--codeleaf-text-tertiary);
      }

      .loading::after {
        content: "";
        width: 20px;
        height: 20px;
        border: 2px solid var(--codeleaf-border-light);
        border-top: 2px solid var(--codeleaf-accent-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-left: var(--codeleaf-space-2);
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Empty States */
      .empty-state {
        text-align: center;
        padding: var(--codeleaf-space-8);
        color: var(--codeleaf-text-tertiary);
        font-style: italic;
      }

      /* Toast Notifications */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 400px;
      }

      .toast {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-left: 4px solid var(--codeleaf-accent-primary);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-4);
        box-shadow: var(--codeleaf-shadow-lg);
        display: flex;
        align-items: flex-start;
        gap: var(--codeleaf-space-3);
        transform: translateX(400px);
        opacity: 0;
        transition: all 0.3s ease-in-out;
      }

      .toast.show {
        transform: translateX(0);
        opacity: 1;
      }

      .toast.hide {
        transform: translateX(400px);
        opacity: 0;
      }

      .toast-icon {
        font-size: 1.2rem;
        flex-shrink: 0;
        margin-top: 2px;
      }

      .toast-content {
        flex: 1;
        min-width: 0;
      }

      .toast-title {
        font-weight: 600;
        margin-bottom: 4px;
        color: var(--codeleaf-text-primary);
        font-size: var(--codeleaf-font-sm);
      }

      .toast-message {
        color: var(--codeleaf-text-secondary);
        font-size: var(--codeleaf-font-sm);
        line-height: 1.4;
      }

      .toast-close {
        background: none;
        border: none;
        color: var(--codeleaf-text-tertiary);
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        font-size: 1.1rem;
      }

      .toast-close:hover {
        color: var(--codeleaf-text-primary);
        background: rgba(76, 166, 76, 0.1);
      }

      /* Enhanced Question History Styles */
      .question-day {
        transition: all 0.3s ease;
        border: 1px solid var(--codeleaf-border-light);
      }

      .question-day:hover {
        border-color: var(--codeleaf-accent-muted);
      }

      .question-day.expanded {
        border-color: var(--codeleaf-accent-primary);
        box-shadow: var(--codeleaf-shadow-md);
      }

      .question-day-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--codeleaf-space-3);
        cursor: pointer;
      }

      .question-day-info {
        flex: 1;
      }

      .question-day-stats {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-2);
        flex-shrink: 0;
      }

      .question-count {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-accent-primary);
        font-weight: 600;
        background: var(--codeleaf-bg-tertiary);
        padding: var(--codeleaf-space-1) var(--codeleaf-space-2);
        border-radius: var(--codeleaf-radius-sm);
        border: 1px solid var(--codeleaf-accent-muted);
      }

      .toggle-day-btn {
        background: none;
        border: none;
        padding: var(--codeleaf-space-1);
        border-radius: var(--codeleaf-radius-sm);
        cursor: pointer;
        color: var(--codeleaf-text-tertiary);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: auto;
        min-width: auto;
      }

      .toggle-day-btn:hover {
        background: var(--codeleaf-bg-tertiary);
        color: var(--codeleaf-accent-primary);
        transform: scale(1.1);
      }

      .toggle-icon {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: var(--codeleaf-font-sm);
        display: inline-block;
      }

      .question-day-details {
        margin-top: var(--codeleaf-space-4);
        padding-top: var(--codeleaf-space-4);
        border-top: 1px solid var(--codeleaf-border-light);
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .solved-questions-list {
        display: flex;
        flex-direction: column;
        gap: var(--codeleaf-space-3);
      }

      .solved-question-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.2s ease;
        animation: slideInUp 0.3s ease forwards;
      }

      .solved-question-item:hover {
        border-color: var(--codeleaf-accent-muted);
        transform: translateX(4px);
      }

      .solved-question-item:nth-child(1) {
        animation-delay: 0.05s;
      }
      .solved-question-item:nth-child(2) {
        animation-delay: 0.1s;
      }
      .solved-question-item:nth-child(3) {
        animation-delay: 0.15s;
      }
      .solved-question-item:nth-child(4) {
        animation-delay: 0.2s;
      }
      .solved-question-item:nth-child(5) {
        animation-delay: 0.25s;
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .question-text {
        flex: 1;
        font-weight: 500;
        color: var(--codeleaf-text-primary);
        line-height: 1.4;
      }

      .question-action-link {
        color: var(--codeleaf-accent-primary);
        text-decoration: none;
        font-size: var(--codeleaf-font-sm);
        padding: var(--codeleaf-space-1) var(--codeleaf-space-3);
        border: 1px solid var(--codeleaf-accent-primary);
        border-radius: var(--codeleaf-radius-sm);
        transition: all 0.2s ease;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .question-action-link:hover {
        background: var(--codeleaf-accent-primary);
        color: white;
        transform: translateY(-1px);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .empty-day-state {
        text-align: center;
        padding: var(--codeleaf-space-4);
        color: var(--codeleaf-text-tertiary);
        font-style: italic;
        background: var(--codeleaf-bg-secondary);
        border-radius: var(--codeleaf-radius-md);
        border: 1px dashed var(--codeleaf-border-light);
      }

      /* Responsive adjustments for question history */
      @media (max-width: 768px) {
        .question-day-header {
          flex-direction: column;
          align-items: flex-start;
          gap: var(--codeleaf-space-2);
        }

        .question-day-stats {
          align-self: flex-end;
        }

        .solved-question-item {
          flex-direction: column;
          align-items: flex-start;
          gap: var(--codeleaf-space-2);
        }

        .question-action-link {
          align-self: flex-start;
        }
      }

      @media (max-width: 480px) {
        .question-count {
          font-size: var(--codeleaf-font-xs);
        }

        .solved-question-item {
          padding: var(--codeleaf-space-2);
        }
      }

      /* Add subtle animation for the toggle button */
      .toggle-day-btn {
        background: none;
        border: none;
        padding: var(--codeleaf-space-1);
        border-radius: var(--codeleaf-radius-sm);
        cursor: pointer;
        color: var(--codeleaf-text-tertiary);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: auto;
        min-width: auto;
        position: relative;
      }

      .toggle-day-btn:hover {
        background: var(--codeleaf-bg-tertiary);
        color: var(--codeleaf-accent-primary);
        transform: scale(1.1);
      }

      .toggle-day-btn:active {
        transform: scale(0.95);
      }

      /* Enhanced visual states for expanded days */
      .question-day.expanded {
        border-color: var(--codeleaf-accent-primary);
        box-shadow: var(--codeleaf-shadow-md);
        background: linear-gradient(
          135deg,
          var(--codeleaf-bg-primary),
          var(--codeleaf-bg-secondary)
        );
      }

      .question-day.expanded .question-count {
        background: var(--codeleaf-accent-primary);
        color: white;
        border-color: var(--codeleaf-accent-primary);
      }

      .question-day.expanded .toggle-day-btn {
        color: var(--codeleaf-accent-primary);
        background: var(--codeleaf-bg-tertiary);
      }

      /* Smooth transition for the entire day card */
      .question-day {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        overflow: hidden;
      }

      /* Enhanced question items with staggered animation */
      .solved-question-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.2s ease;
        animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        opacity: 0;
        transform: translateY(8px);
      }

      /* Staggered animation for better visual appeal */
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(1) {
        animation-delay: 0.05s;
      }
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(2) {
        animation-delay: 0.1s;
      }
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(3) {
        animation-delay: 0.15s;
      }
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(4) {
        animation-delay: 0.2s;
      }
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(5) {
        animation-delay: 0.25s;
      }
      .question-day-details[style*="display: block"]
        .solved-question-item:nth-child(6) {
        animation-delay: 0.3s;
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Enhanced focus states for accessibility */
      .toggle-day-btn:focus-visible {
        outline: 2px solid var(--codeleaf-accent-primary);
        outline-offset: 2px;
      }

      .question-action-link:focus-visible {
        outline: 2px solid var(--codeleaf-accent-primary);
        outline-offset: 2px;
      }

      /* Enhanced Community Section Styles */
      .user-item {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-3);
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .user-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(76, 166, 76, 0.1),
          transparent
        );
        transition: left 0.6s ease;
      }

      .user-item:hover::before {
        left: 100%;
      }

      .user-item:hover {
        border-color: var(--codeleaf-accent-muted);
        transform: translateY(-2px);
        box-shadow: var(--codeleaf-shadow-md);
      }

      .user-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: var(--codeleaf-font-lg);
        font-weight: 600;
        flex-shrink: 0;
        border: 3px solid var(--codeleaf-bg-primary);
        box-shadow: var(--codeleaf-shadow-sm);
        transition: all 0.3s ease;
      }

      .user-item:hover .user-avatar {
        transform: scale(1.1);
        box-shadow: var(--codeleaf-shadow-md);
      }

      .user-details {
        flex: 1;
        min-width: 0;
      }

      .user-name {
        font-weight: 600;
        color: var(--codeleaf-text-primary);
        margin-bottom: var(--codeleaf-space-1);
        font-size: var(--codeleaf-font-sm);
        line-height: 1.2;
      }

      .user-stats {
        display: flex;
        gap: var(--codeleaf-space-2);
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        flex-wrap: wrap;
      }

      .user-stat {
        display: flex;
        align-items: center;
        gap: 2px;
        background: var(--codeleaf-bg-primary);
        padding: 2px 6px;
        border-radius: 10px;
        border: 1px solid var(--codeleaf-border-light);
      }

      .user-action {
        color: var(--codeleaf-accent-primary);
        font-size: var(--codeleaf-font-xs);
        font-weight: 600;
        padding: var(--codeleaf-space-1) var(--codeleaf-space-2);
        border: 1px solid var(--codeleaf-accent-muted);
        border-radius: var(--codeleaf-radius-sm);
        background: var(--codeleaf-bg-primary);
        transition: all 0.2s ease;
        flex-shrink: 0;
        opacity: 0;
        transform: translateX(10px);
      }

      .user-item:hover .user-action {
        opacity: 1;
        transform: translateX(0);
      }

      /* Empty state enhancements */
      .empty-state {
        text-align: center;
        padding: var(--codeleaf-space-6);
        color: var(--codeleaf-text-tertiary);
        font-style: italic;
        background: var(--codeleaf-bg-secondary);
        border-radius: var(--codeleaf-radius-md);
        border: 1px dashed var(--codeleaf-border-light);
      }

      .empty-state small {
        display: block;
        margin-top: var(--codeleaf-space-1);
        opacity: 0.7;
        font-size: var(--codeleaf-font-xs);
      }

      /* Loading animation */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: var(--codeleaf-space-6);
        color: var(--codeleaf-text-tertiary);
        gap: var(--codeleaf-space-2);
      }

      .loading::after {
        content: "";
        width: 16px;
        height: 16px;
        border: 2px solid var(--codeleaf-border-light);
        border-top: 2px solid var(--codeleaf-accent-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .user-item {
          padding: var(--codeleaf-space-2);
        }

        .user-avatar {
          width: 40px;
          height: 40px;
          font-size: var(--codeleaf-font-base);
        }

        .user-stats {
          gap: var(--codeleaf-space-1);
        }

        .user-stat {
          padding: 1px 4px;
          font-size: 0.65rem;
        }

        .user-action {
          display: none; /* Hide on mobile for cleaner look */
        }
      }

      @media (max-width: 480px) {
        .user-item {
          flex-direction: column;
          text-align: center;
          gap: var(--codeleaf-space-2);
        }

        .user-details {
          width: 100%;
        }

        .user-stats {
          justify-content: center;
        }
      }

      /* Animation for user items */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .user-item {
        animation: fadeInUp 0.5s ease forwards;
        opacity: 0;
      }

      .user-item:nth-child(1) {
        animation-delay: 0.1s;
      }
      .user-item:nth-child(2) {
        animation-delay: 0.2s;
      }
      .user-item:nth-child(3) {
        animation-delay: 0.3s;
      }
      .user-item:nth-child(4) {
        animation-delay: 0.4s;
      }
      .user-item:nth-child(5) {
        animation-delay: 0.5s;
      }

      /* Enhanced Profile Header Styles */
      .profile-name-container {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        flex-wrap: wrap;
        margin-bottom: var(--codeleaf-space-2);
      }

      .user-level-badge {
        position: absolute;
        bottom: -8px;
        right: -8px;
        background: linear-gradient(
          135deg,
          var(--codeleaf-accent-primary),
          var(--codeleaf-accent-secondary)
        );
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: var(--codeleaf-font-xs);
        font-weight: 700;
        border: 3px solid var(--codeleaf-bg-primary);
        box-shadow: var(--codeleaf-shadow-sm);
        z-index: 2;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .avatar-container {
        position: relative;
        flex-shrink: 0;
      }

      .profile-badge {
        background: var(--codeleaf-accent-muted);
        color: var(--codeleaf-accent-primary);
        padding: 4px 12px;
        border-radius: 12px;
        font-size: var(--codeleaf-font-xs);
        font-weight: 600;
        border: 1px solid var(--codeleaf-accent-muted);
      }

      .stat-trend {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        margin-top: 4px;
        font-weight: 500;
      }

      /* Profile Details Grid */
      .profile-details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: var(--codeleaf-space-3);
        margin-top: var(--codeleaf-space-4);
        padding-top: var(--codeleaf-space-4);
        border-top: 1px solid var(--codeleaf-border-light);
      }

      .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--codeleaf-space-2);
        background: var(--codeleaf-bg-secondary);
        border-radius: var(--codeleaf-radius-sm);
        border: 1px solid var(--codeleaf-border-light);
      }

      .detail-label {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        font-weight: 500;
      }

      .detail-value {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-accent-primary);
        font-weight: 600;
      }

      /* Level Badge Colors */
      .user-level-badge.noob {
        background: linear-gradient(135deg, #6b856b, #88a488);
      }
      .user-level-badge.beginner {
        background: linear-gradient(135deg, #4ca64c, #5cb85c);
      }
      .user-level-badge.intermediate {
        background: linear-gradient(135deg, #2d7a2d, #4ca64c);
      }
      .user-level-badge.advanced {
        background: linear-gradient(135deg, #1a5a1a, #2d7a2d);
      }
      .user-level-badge.expert {
        background: linear-gradient(135deg, #0a3a0a, #1a5a1a);
      }
      .user-level-badge.master {
        background: linear-gradient(135deg, #002200, #0a3a0a);
      }
      .user-level-badge.champion {
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        color: #1a3a1a;
      }

      /* Responsive Design for Enhanced Header */
      @media (max-width: 768px) {
        .profile-details-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .profile-name-container {
          flex-direction: column;
          align-items: flex-start;
          gap: var(--codeleaf-space-2);
        }
      }

      @media (max-width: 480px) {
        .profile-details-grid {
          grid-template-columns: 1fr;
        }

        .user-level-badge {
          bottom: -6px;
          right: -6px;
          font-size: 0.6rem;
          padding: 3px 8px;
        }
      }

      /* Level Badge Colors - Updated for new level names */
      .user-level-badge.fresh-coder {
        background: linear-gradient(135deg, #6b856b, #88a488);
        color: white;
      }
      .user-level-badge.syntax-sprout {
        background: linear-gradient(135deg, #4ca64c, #5cb85c);
        color: white;
      }
      .user-level-badge.pattern-explorer {
        background: linear-gradient(135deg, #2d7a2d, #4ca64c);
        color: white;
      }
      .user-level-badge.logic-virtuoso {
        background: linear-gradient(135deg, #1a5a1a, #2d7a2d);
        color: white;
      }
      .user-level-badge.algorithm-sage {
        background: linear-gradient(135deg, #0a3a0a, #1a5a1a);
        color: white;
      }
      .user-level-badge.flow-master {
        background: linear-gradient(135deg, #002200, #0a3a0a);
        color: white;
      }
      .user-level-badge.code-luminary {
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        color: #1a3a1a;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* Level Up Guide Styles */
      .level-up-guide {
        background: var(--codeleaf-bg-primary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-lg);
        padding: var(--codeleaf-space-6);
        box-shadow: var(--codeleaf-shadow-sm);
      }

      .guide-content {
        display: flex;
        flex-direction: column;
        gap: var(--codeleaf-space-4);
      }

      .guide-tips,
      .xp-breakdown,
      .level-meanings {
        background: var(--codeleaf-bg-secondary);
        border: 1px solid var(--codeleaf-border-light);
        border-radius: var(--codeleaf-radius-md);
        padding: var(--codeleaf-space-4);
      }

      .guide-tips h3,
      .xp-breakdown h3,
      .level-meanings h3 {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-accent-primary);
        margin-bottom: var(--codeleaf-space-3);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-2);
      }

      /* Tips Styles */
      .tip-item {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-2) 0;
        border-bottom: 1px solid var(--codeleaf-border-light);
      }

      .tip-item:last-child {
        border-bottom: none;
      }

      .tip-icon {
        font-size: var(--codeleaf-font-lg);
        flex-shrink: 0;
        width: 24px;
        text-align: center;
      }

      .tip-text {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
        line-height: 1.4;
      }

      /* XP Breakdown Styles */
      .xp-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--codeleaf-space-2) 0;
        border-bottom: 1px solid var(--codeleaf-border-light);
      }

      .xp-item:last-child {
        border-bottom: none;
      }

      .xp-source {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
      }

      .xp-value {
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-accent-primary);
        font-weight: 600;
        background: var(--codeleaf-bg-primary);
        padding: 2px 8px;
        border-radius: 12px;
        border: 1px solid var(--codeleaf-accent-muted);
      }

      /* Level Meanings Styles */
      .level-item {
        display: flex;
        align-items: center;
        gap: var(--codeleaf-space-3);
        padding: var(--codeleaf-space-2) 0;
        border-bottom: 1px solid var(--codeleaf-border-light);
      }

      .level-item:last-child {
        border-bottom: none;
      }

      .level-badge-small {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--codeleaf-font-sm);
        flex-shrink: 0;
        border: 2px solid var(--codeleaf-bg-primary);
      }

      .level-info {
        flex: 1;
      }

      .level-info strong {
        display: block;
        font-size: var(--codeleaf-font-sm);
        color: var(--codeleaf-text-primary);
        margin-bottom: 2px;
      }

      .level-info small {
        font-size: var(--codeleaf-font-xs);
        color: var(--codeleaf-text-tertiary);
        line-height: 1.3;
      }

      /* Level badge colors for the guide */
      .level-badge-small.seedling {
        background: linear-gradient(135deg, #6b856b, #88a488);
      }
      .level-badge-small.sprout {
        background: linear-gradient(135deg, #4ca64c, #5cb85c);
      }
      .level-badge-small.builder {
        background: linear-gradient(135deg, #2d7a2d, #4ca64c);
      }
      .level-badge-small.explorer {
        background: linear-gradient(135deg, #1a5a1a, #2d7a2d);
      }
      .level-badge-small.sage {
        background: linear-gradient(135deg, #0a3a0a, #1a5a1a);
      }
      .level-badge-small.virtuoso {
        background: linear-gradient(135deg, #002200, #0a3a0a);
      }
      .level-badge-small.luminary {
        background: linear-gradient(135deg, #ffd700, #ffed4e);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .guide-content {
          gap: var(--codeleaf-space-3);
        }

        .guide-tips,
        .xp-breakdown,
        .level-meanings {
          padding: var(--codeleaf-space-3);
        }

        .tip-item,
        .xp-item,
        .level-item {
          padding: var(--codeleaf-space-1) 0;
        }

        .level-badge-small {
          width: 28px;
          height: 28px;
          font-size: var(--codeleaf-font-xs);
        }
      }

      @media (max-width: 480px) {
        .level-up-guide {
          padding: var(--codeleaf-space-4);
        }

        .tip-item,
        .xp-item {
          flex-direction: column;
          align-items: flex-start;
          gap: var(--codeleaf-space-1);
        }

        .xp-value {
          align-self: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-container">
          <h1 class="site-logo">FocusFlow Profile</h1>
          <div class="nav-links">
            <a href="/index.html" class="nav-link"> Back to Tracker</a>
            <a href="/blogs.html" class="nav-link"> Blogs</a>
            <a href="/profile.html" class="nav-link active"> Profile</a>
          </div>
        </div>
      </header>

      <div class="main-container">
        <!-- Left Column (70%) -->
        <div class="left-column">
          <!-- Profile Header -->
          <!-- Enhanced Profile Header -->
          <div class="profile-header">
            <div class="avatar-container">
              <div class="pixel-avatar" id="userAvatar"></div>
              <div class="user-level-badge" id="userLevelBadge">Noob</div>
            </div>
            <div class="profile-info">
              <div class="profile-name-container">
                <h1 class="profile-name" id="userName">Loading...</h1>
                <div class="profile-badge" id="profileOwnerBadge">
                  My Profile
                </div>
              </div>
              <p class="profile-bio" id="userBio">
                Member since <span id="joinDate">...</span>
              </p>

              <!-- Enhanced Stats Grid -->
              <div class="profile-stats">
                <div class="stat-item">
                  <div class="stat-value" id="totalSolved">0</div>
                  <div class="stat-label">Problems Solved</div>
                  <div class="stat-trend" id="solvedTrend">+0 today</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="totalBlogs">0</div>
                  <div class="stat-label">Blogs Written</div>
                  <div class="stat-trend" id="blogsTrend">+0 this week</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="currentStreak">0</div>
                  <div class="stat-label">Day Streak</div>
                  <div class="stat-trend" id="streakStatus">Keep going! </div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="activeDays">0</div>
                  <div class="stat-label">Active Days</div>
                  <div class="stat-trend" id="activityTrend">Consistency</div>
                </div>
              </div>

              <!-- Additional Profile Details -->
              <div class="profile-details-grid">
                <div class="detail-item">
                  <span class="detail-label">Current Level</span>
                  <span class="detail-value" id="userLevel">Noob</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Total XP</span>
                  <span class="detail-value" id="totalXP">0</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Avg. Daily</span>
                  <span class="detail-value" id="avgDaily">0</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Max Streak</span>
                  <span class="detail-value" id="maxStreak">0</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Achievements Section -->
          <div class="achievements-section">
            <h2 class="section-title"> Achievements</h2>
            <div class="achievements-grid" id="achievementsGrid">
              <div class="loading">Loading achievements...</div>
            </div>
          </div>

          <!-- Question History -->
          <div class="content-section">
            <h2 class="section-title"> Question History</h2>
            <div class="content-grid" id="questionHistory">
              <div class="loading">Loading question history...</div>
            </div>
          </div>

          <!-- Blogs Section -->
          <div class="content-section">
            <h2 class="section-title"> My Blogs</h2>
            <div class="tabs" style="margin-bottom: var(--codeleaf-space-4)">
              <button class="tab active" onclick="switchBlogTab('public')">
                Public Blogs
              </button>
              <button class="tab" onclick="switchBlogTab('private')">
                Private Blogs
              </button>
            </div>
            <div class="content-grid" id="blogsContent">
              <div class="loading">Loading blogs...</div>
            </div>
          </div>
        </div>

        <!-- Right Column (30%) -->
        <div class="right-column">
          <!-- Consistency Map -->
          <div class="consistency-map">
            <h2 class="section-title"> Consistency Map</h2>
            <div class="heatmap-container">
              <div class="heatmap-header">
                <div class="heatmap-title">Activity Heatmap</div>
                <div class="heatmap-legend">
                  <span>Less</span>
                  <div class="legend-colors">
                    <div class="legend-color level-0"></div>
                    <div class="legend-color level-1"></div>
                    <div class="legend-color level-2"></div>
                    <div class="legend-color level-3"></div>
                    <div class="legend-color level-4"></div>
                  </div>
                  <span>More</span>
                </div>
              </div>
              <div class="heatmap-content">
                <div class="months-row" id="heatmapMonths">
                  <!-- Month labels will be generated by JavaScript -->
                </div>
                <div class="heatmap-grid" id="heatmapGrid">
                  <!-- Heatmap cells will be generated by JavaScript -->
                </div>
              </div>
            </div>
          </div>

          <!-- Progress Visualization -->
          <div class="progress-section">
            <h2 class="section-title"> Progress Overview</h2>
            <div class="progress-bars" id="progressBars">
              <div class="loading">Loading progress data...</div>
            </div>
          </div>

          <!-- User Directory -->
          <div class="user-directory">
            <h2 class="section-title"> Community</h2>
            <div class="user-grid" id="userDirectory">
              <div class="loading">Loading community data...</div>
            </div>
          </div>

          <!-- Level Up Guide Section -->
          <div class="level-up-guide">
            <h2 class="section-title"> How to Level Up</h2>
            <div class="guide-content">
              <!-- Quick Tips -->
              <div class="guide-tips">
                <h3> Quick Tips</h3>
                <div class="tip-item">
                  <span class="tip-icon"></span>
                  <span class="tip-text"
                    >Solve problems daily to build consistency</span
                  >
                </div>
                <div class="tip-item">
                  <span class="tip-icon"></span>
                  <span class="tip-text"
                    >Write blogs to share knowledge (+25 XP each)</span
                  >
                </div>
                <div class="tip-item">
                  <span class="tip-icon"></span>
                  <span class="tip-text">Maintain streaks for bonus XP</span>
                </div>
                <div class="tip-item">
                  <span class="tip-icon"></span>
                  <span class="tip-text">Engage with community blogs</span>
                </div>
              </div>

              <!-- XP Breakdown -->
              <div class="xp-breakdown">
                <h3> XP Breakdown</h3>
                <div class="xp-item">
                  <span class="xp-source">Problems Solved</span>
                  <span class="xp-value">+10 XP each</span>
                </div>
                <div class="xp-item">
                  <span class="xp-source">Blogs Published</span>
                  <span class="xp-value">+25 XP each</span>
                </div>
                <div class="xp-item">
                  <span class="xp-source">Daily Streak</span>
                  <span class="xp-value">+5 XP per day</span>
                </div>
                <div class="xp-item">
                  <span class="xp-source">Blog Likes Received</span>
                  <span class="xp-value">+3 XP each</span>
                </div>
              </div>

              <!-- Level Meanings -->
              <div class="level-meanings">
                <h3> Level Guide</h3>
                <div class="level-item">
                  <span class="level-badge-small seedling"></span>
                  <div class="level-info">
                    <strong>Seedling</strong>
                    <small>Just starting your coding journey</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small sprout"></span>
                  <div class="level-info">
                    <strong>Sprout</strong>
                    <small>Growing your skills steadily</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small builder"></span>
                  <div class="level-info">
                    <strong>Builder</strong>
                    <small>Building solid foundations</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small explorer"></span>
                  <div class="level-info">
                    <strong>Explorer</strong>
                    <small>Exploring advanced concepts</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small sage"></span>
                  <div class="level-info">
                    <strong>Sage</strong>
                    <small>Gaining deep knowledge</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small virtuoso"></span>
                  <div class="level-info">
                    <strong>Virtuoso</strong>
                    <small>Mastering the craft</small>
                  </div>
                </div>
                <div class="level-item">
                  <span class="level-badge-small luminary"></span>
                  <div class="level-info">
                    <strong>Luminary</strong>
                    <small>Shining example to the community</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
      // API Configuration
      const API_BASE_URL = "https://focus-flow-lopn.onrender.com/api";
      let currentUserData = null;
      let currentBlogTab = "public";

      // Toast Notification System
      class ToastManager {
        constructor() {
          this.container = document.getElementById("toastContainer");
          if (!this.container) {
            this.container = document.createElement("div");
            this.container.className = "toast-container";
            this.container.id = "toastContainer";
            document.body.appendChild(this.container);
          }
          this.toastId = 0;
        }

        showToast(message, type = "info", title = "", duration = 5000) {
          const toastId = this.toastId++;
          const toast = document.createElement("div");
          toast.className = `toast ${type}`;
          toast.id = `toast-${toastId}`;

          const icon = this.getIcon(type);
          toast.innerHTML = `
                    <div class="toast-icon">${icon}</div>
                    <div class="toast-content">
                        ${
                          title ? `<div class="toast-title">${title}</div>` : ""
                        }
                        <div class="toast-message">${message}</div>
                    </div>
                    <button class="toast-close" onclick="toastManager.hideToast(${toastId})"></button>
                `;

          this.container.appendChild(toast);
          setTimeout(() => toast.classList.add("show"), 10);

          if (duration > 0) {
            setTimeout(() => this.hideToast(toastId), duration);
          }

          return toastId;
        }

        hideToast(toastId) {
          const toast = document.getElementById(`toast-${toastId}`);
          if (toast) {
            toast.classList.remove("show");
            toast.classList.add("hide");
            setTimeout(() => {
              if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
              }
            }, 300);
          }
        }

        getIcon(type) {
          const icons = {
            success: "",
            error: "",
            warning: "",
            info: "",
          };
          return icons[type] || icons.info;
        }

        success(message, title = "Success", duration = 5000) {
          return this.showToast(message, "success", title, duration);
        }

        error(message, title = "Error", duration = 7000) {
          return this.showToast(message, "error", title, duration);
        }

        warning(message, title = "Warning", duration = 6000) {
          return this.showToast(message, "warning", title, duration);
        }

        info(message, title = "Info", duration = 4000) {
          return this.showToast(message, "info", title, duration);
        }
      }

      // Initialize toast manager
      const toastManager = new ToastManager();

      // Pixel Avatar System - Generate unique avatar based on username
      function generatePixelAvatar(username) {
        const animals = [
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
        ];
        const emojis = [
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
        ];

        // Use username to generate consistent avatar
        const hash = username.split("").reduce((a, b) => {
          a = (a << 5) - a + b.charCodeAt(0);
          return a & a;
        }, 0);

        const allOptions = [...animals, ...emojis];
        const index = Math.abs(hash) % allOptions.length;
        return allOptions[index];
      }

      // Format date for display
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      // Format relative time
      function formatRelativeTime(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays === 1) return "Yesterday";
        if (diffDays < 7) return `${diffDays} days ago`;
        if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
        return formatDate(dateString);
      }

      // Enhanced user level calculation with single-word, positive names
      function calculateUserLevel(user) {
        const totalSolved = user.statistics?.totalProblemsSolved || 0;
        const currentStreak = user.statistics?.currentStreak || 0;
        const totalBlogs = user.statistics?.totalBlogsPublished || 0;
        const totalXP = calculateTotalXP(user);

        // Single-word, positive level names unique to FocusFlow
        if (totalXP >= 1000) return { level: "Luminary", xp: totalXP };
        if (totalXP >= 500) return { level: "Virtuoso", xp: totalXP };
        if (totalXP >= 250) return { level: "Sage", xp: totalXP };
        if (totalXP >= 100) return { level: "Explorer", xp: totalXP };
        if (totalXP >= 50) return { level: "Builder", xp: totalXP };
        if (totalXP >= 10) return { level: "Sprout", xp: totalXP };
        return { level: "Seedling", xp: totalXP };
      }
      // Calculate total XP based on various factors
      function calculateTotalXP(user) {
        const totalSolved = user.statistics?.totalProblemsSolved || 0;
        const totalBlogs = user.statistics?.totalBlogsPublished || 0;
        const currentStreak = user.statistics?.currentStreak || 0;
        const maxStreak = user.statistics?.maxStreak || 0;
        const blogLikes = user.statistics?.totalBlogLikes || 0;

        // XP calculation formula
        let xp = 0;
        xp += totalSolved * 10; // 10 XP per problem
        xp += totalBlogs * 25; // 25 XP per blog
        xp += currentStreak * 5; // 5 XP per day of current streak
        xp += maxStreak * 2; // 2 XP per day of max streak
        xp += blogLikes * 3; // 3 XP per blog like

        return Math.floor(xp);
      }

      // Calculate today's solved problems
      function calculateTodaySolved(user) {
        const today = new Date().toISOString().split("T")[0];
        const activityData = user.activity?.heatmapData || {};
        return activityData[today] || 0;
      }

      // Calculate this week's blogs
      function calculateThisWeekBlogs(user) {
        // Simple implementation - you can enhance this with actual blog dates
        const recentBlogs = user.blogs?.recentBlogs || [];
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

        return recentBlogs.filter(
          (blog) => new Date(blog.createdAt) > oneWeekAgo
        ).length;
      }

      // Calculate active days
      function calculateActiveDays(user) {
        const heatmapData = user.activity?.heatmapData || {};
        return Object.values(heatmapData).filter((count) => count > 0).length;
      }

      // Get streak status message
      function getStreakStatus(currentStreak) {
        if (currentStreak === 0) return "Start your streak!";
        if (currentStreak < 3) return "Keep going! ";
        if (currentStreak < 7) return "Building momentum! ";
        if (currentStreak < 14) return "On fire! ";
        if (currentStreak < 30) return "Unstoppable! ";
        return "Legendary streak! ";
      }

      // Render question history with expandable days
      function renderQuestionHistory() {
        const container = document.getElementById("questionHistory");

        if (!currentUserData) return;

        const questions = currentUserData.consistency?.dailyProgress || [];
        const solvedQuestions = questions
          .flatMap((day) =>
            day.completedQuestions > 0
              ? [
                  {
                    day: day.day,
                    date: day.date,
                    solved: day.completedQuestions,
                    total: day.totalQuestions,
                    questions: getQuestionsForDay(day.day), // Get actual questions for this day
                  },
                ]
              : []
          )
          .reverse()
          .slice(0, 10); // Show last 10 days with activity

        if (solvedQuestions.length === 0) {
          container.innerHTML =
            '<div class="empty-state">No questions solved yet. Start your coding journey!</div>';
          return;
        }

        container.innerHTML = solvedQuestions
          .map(
            (day) => `
        <div class="content-item question-day" data-day="${day.day}">
            <div class="question-day-header">
                <div class="question-day-info">
                    <div class="question-title">Day ${day.day} Progress</div>
                    <div class="question-date">${
                      day.date ? formatDate(day.date) : `Day ${day.day}`
                    }</div>
                </div>
                <div class="question-day-stats">
                    <span class="question-count">${day.solved}/${
              day.total
            } solved</span>
                    <button class="toggle-day-btn" onclick="toggleDayDetails(${
                      day.day
                    })" aria-label="Toggle day details">
                        <span class="toggle-icon"></span>
                    </button>
                </div>
            </div>
            <div class="question-day-details" id="day-${
              day.day
            }-details" style="display: none;">
                <div class="solved-questions-list">
                    ${renderDayQuestions(day.questions)}
                </div>
            </div>
        </div>
    `
          )
          .join("");
      }

      // Helper function to get questions for a specific day
      function getQuestionsForDay(dayNumber) {
        // This function needs access to the main checklist data
        // You might need to load this separately or ensure it's included in user-info
        const checklistData =
          window.checklistData || getChecklistDataFromStorage();

        if (!checklistData || !Array.isArray(checklistData)) {
          console.warn("Checklist data not available");
          return [];
        }

        const dayData = checklistData.find((day) => day.day === dayNumber);
        if (!dayData || !dayData.questions) return [];

        // Return only completed questions
        return dayData.questions
          .filter((q) => q.completed)
          .map((q) => ({
            text: q.text || "Untitled Question",
            link: q.link || "",
            completed: true,
          }));
      }

      // Helper to get checklist data from localStorage
      function getChecklistDataFromStorage() {
        try {
          const savedData = localStorage.getItem("dsaChecklistData");
          return savedData ? JSON.parse(savedData) : null;
        } catch (error) {
          console.error("Error loading checklist data:", error);
          return null;
        }
      }
      // Render individual questions for a day
      function renderDayQuestions(questions) {
        if (!questions || questions.length === 0) {
          return '<div class="empty-day-state">No questions solved this day</div>';
        }

        return questions
          .map(
            (question) => `
        <div class="solved-question-item">
            <div class="question-text">${escapeHtml(question.text)}</div>
            ${
              question.link
                ? `
                <a href="${
                  question.link
                }" target="_blank" rel="noopener noreferrer" class="question-action-link">
                    ${
                      question.link.includes("leetcode.com")
                        ? "Solve this"
                        : "See this question"
                    } 
                </a>
            `
                : ""
            }
        </div>
    `
          )
          .join("");
      }

      // Toggle day details with smooth animation and auto-close others
      function toggleDayDetails(dayNumber) {
        const detailsElement = document.getElementById(
          `day-${dayNumber}-details`
        );
        const toggleIcon = document.querySelector(
          `[onclick="toggleDayDetails(${dayNumber})"] .toggle-icon`
        );
        const dayElement = document.querySelector(`[data-day="${dayNumber}"]`);

        if (!detailsElement || !toggleIcon || !dayElement) return;

        // Check if we're opening or closing
        const isOpening = detailsElement.style.display === "none";

        // Close all other open days first (if opening a new one)
        if (isOpening) {
          closeAllOtherDays(dayNumber);
        }

        if (isOpening) {
          // Expand with smooth animation
          detailsElement.style.display = "block";
          // Small delay to ensure display change is processed
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              detailsElement.style.opacity = "1";
              detailsElement.style.transform = "translateY(0)";
              toggleIcon.style.transform = "rotate(180deg)";
              dayElement.classList.add("expanded");
            });
          });
        } else {
          // Collapse with smooth animation
          detailsElement.style.opacity = "0";
          detailsElement.style.transform = "translateY(-10px)";
          toggleIcon.style.transform = "rotate(0deg)";
          dayElement.classList.remove("expanded");

          setTimeout(() => {
            detailsElement.style.display = "none";
          }, 300);
        }
      }

      // Close all other open days except the specified one
      function closeAllOtherDays(exceptDayNumber) {
        document
          .querySelectorAll(".question-day.expanded")
          .forEach((dayElement) => {
            const dayNum = parseInt(dayElement.dataset.day);
            if (dayNum !== exceptDayNumber) {
              const otherDetails = document.getElementById(
                `day-${dayNum}-details`
              );
              const otherToggleIcon = document.querySelector(
                `[onclick="toggleDayDetails(${dayNum})"] .toggle-icon`
              );

              if (otherDetails && otherToggleIcon) {
                // Animate collapse
                otherDetails.style.opacity = "0";
                otherDetails.style.transform = "translateY(-10px)";
                otherToggleIcon.style.transform = "rotate(0deg)";
                dayElement.classList.remove("expanded");

                setTimeout(() => {
                  otherDetails.style.display = "none";
                }, 300);
              }
            }
          });
      }

      // Enhanced keyboard navigation support
      function enhanceKeyboardNavigation() {
        document.addEventListener("keydown", function (event) {
          // Close all dropdowns when Escape is pressed
          if (event.key === "Escape") {
            closeAllOtherDays(-1); // Close all days
          }

          // Support arrow key navigation between days
          if (event.key === "ArrowDown" || event.key === "ArrowUp") {
            const focusedElement = document.activeElement;
            if (focusedElement.classList.contains("toggle-day-btn")) {
              event.preventDefault();
              navigateDays(event.key === "ArrowDown" ? 1 : -1, focusedElement);
            }
          }
        });
      }

      // Navigate between days with arrow keys
      function navigateDays(direction, currentButton) {
        const allDayButtons = Array.from(
          document.querySelectorAll(".toggle-day-btn")
        );
        const currentIndex = allDayButtons.indexOf(currentButton);
        const nextIndex =
          (currentIndex + direction + allDayButtons.length) %
          allDayButtons.length;

        if (allDayButtons[nextIndex]) {
          allDayButtons[nextIndex].focus();
        }
      }

      // Initialize keyboard navigation when DOM is loaded
      document.addEventListener("DOMContentLoaded", function () {
        enhanceKeyboardNavigation();
      });

      // Close all other open days when opening a new one (optional)
      function closeOtherDays(currentDayNumber) {
        document
          .querySelectorAll(".question-day.expanded")
          .forEach((dayElement) => {
            const dayNum = parseInt(dayElement.dataset.day);
            if (dayNum !== currentDayNumber) {
              toggleDayDetails(dayNum);
            }
          });
      }

      // Load user profile data
      async function loadUserProfile() {
        try {
          const token = localStorage.getItem("authToken");
          if (!token) {
            window.location.href = "/index.html";
            return;
          }

          const response = await fetch(`${API_BASE_URL}/user-info`, {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load user data");
          }

          const result = await response.json();

          if (result.success) {
            currentUserData = result.user;
            renderUserProfile();
            renderAchievements();
            renderQuestionHistory();
            renderBlogs();
            renderConsistencyMap();
            renderProgressBars();
            loadUserDirectory();
          } else {
            throw new Error(result.error || "Failed to load user data");
          }
        } catch (error) {
          console.error("Error loading user profile:", error);
          toastManager.error("Failed to load profile data", "Profile Error");
        }
      }

      // Enhanced render function with all new features - FIXED for profile.html
      function renderUserProfile() {
        if (!currentUserData) return; // Use currentUserData instead of currentViewingUser

        const user = currentUserData; // Use currentUserData
        const userLevel = calculateUserLevel(user);
        const todaySolved = calculateTodaySolved(user);
        const thisWeekBlogs = calculateThisWeekBlogs(user);
        const activeDays = calculateActiveDays(user);
        const avgDaily = user.activity?.averageDaily || 0;
        const maxStreak = user.statistics?.maxStreak || 0;

        // Set avatar and level badge
        const avatarElement = document.getElementById("userAvatar");
        avatarElement.textContent = generatePixelAvatar(user.username);

        const levelBadge = document.getElementById("userLevelBadge");
        levelBadge.textContent = userLevel.level;
        levelBadge.className = `user-level-badge ${userLevel.level.toLowerCase()}`;

        // Set user name and bio
        document.getElementById("userName").textContent = user.username;
        document.getElementById("joinDate").textContent = formatDate(
          user.accountCreated
        );

        // Update profile badge based on context
        const profileBadge = document.getElementById("profileOwnerBadge");
        if (window.location.pathname.includes("user-profile.html")) {
          profileBadge.textContent = "Viewing Profile";
        } else {
          profileBadge.textContent = "My Profile";
        }

        // Set main stats
        document.getElementById("totalSolved").textContent =
          user.statistics?.totalProblemsSolved || 0;
        document.getElementById("totalBlogs").textContent =
          user.statistics?.totalBlogsPublished || 0;
        document.getElementById("currentStreak").textContent =
          user.statistics?.currentStreak || 0;
        document.getElementById("activeDays").textContent = activeDays;

        // Set trend indicators
        document.getElementById("solvedTrend").textContent =
          todaySolved > 0 ? `+${todaySolved} today` : "+0 today";
        document.getElementById("blogsTrend").textContent =
          thisWeekBlogs > 0 ? `+${thisWeekBlogs} this week` : "+0 this week";
        document.getElementById("streakStatus").textContent = getStreakStatus(
          user.statistics?.currentStreak || 0
        );
        document.getElementById("activityTrend").textContent =
          avgDaily > 2 ? "Highly Active" : "Building Consistency";

        // Set detailed profile information
        document.getElementById("userLevel").textContent = userLevel.level;
        document.getElementById("totalXP").textContent = userLevel.xp;
        document.getElementById("avgDaily").textContent = avgDaily.toFixed(1);
        document.getElementById("maxStreak").textContent = maxStreak;
      }

      // Enhanced achievements rendering with tooltips
      function renderAchievements() {
        const grid = document.getElementById("achievementsGrid");
        const userData = currentUserData || currentViewingUser; // Works for both pages

        if (!userData) return;

        const achievements = calculateAchievements(userData);

        if (achievements.length === 0) {
          grid.innerHTML =
            '<div class="empty-state">No achievements yet. Start coding to earn your first achievement!</div>';
          return;
        }

        grid.innerHTML = achievements
          .map((achievement) => {
            const tooltipText = getAchievementTooltip(achievement);
            const progressBar =
              !achievement.unlocked && achievement.progress > 0
                ? `<div class="achievement-progress">
                    <div class="achievement-progress-bar" style="width: ${achievement.progress}%"></div>
                </div>`
                : "";

            // Round progress to whole number for display
            const roundedProgress = Math.round(achievement.progress);

            return `
                <div class="achievement-card ${
                  achievement.unlocked ? "unlocked" : ""
                }">
                    <div class="achievement-lock"></div>
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-title">${achievement.title}</div>
                    ${progressBar}
                    <div class="achievement-tooltip">
                        <strong>${achievement.title}</strong><br>
                        ${tooltipText}
                        ${
                          !achievement.unlocked
                            ? `<br><small>Progress:  ${roundedProgress}%</small>`
                            : ""
                        }
                    </div>
                </div>
            `;
          })
          .join("");
      }

      // Helper function to get achievement tooltip text
      function getAchievementTooltip(achievement) {
        const tooltips = {
          "First Steps":
            "Solve your very first coding problem to unlock this achievement",
          "Problem Solver":
            "Reach 50 problems solved to become a reliable problem solver",
          "Code Master":
            "Achieve mastery by solving 100 problems across various topics",
          Blogger:
            "Share your knowledge by writing and publishing your first blog post",
          "Content Creator":
            "Become a content creator by publishing 5 helpful blogs",
          "Consistency King":
            "Maintain a 7-day coding streak to build strong habits",
          "Dedicated Learner":
            "Show incredible dedication with a 30-day coding streak",
          "Community Star":
            "Get 10 likes on your blogs to become a community favorite",
        };
        return tooltips[achievement.title] || achievement.description;
      }

      // Calculate user achievements based on data
      function calculateAchievements(user) {
        const totalSolved = user.statistics?.totalProblemsSolved || 0;
        const totalBlogs = user.statistics?.totalBlogsPublished || 0;
        const currentStreak = user.statistics?.currentStreak || 0;
        const maxStreak = user.statistics?.maxStreak || 0;
        const blogLikes = user.statistics?.totalBlogLikes || 0;

        return [
          {
            icon: "",
            title: "First Steps",
            description: "Solve your first problem",
            unlocked: totalSolved >= 1,
            progress: Math.min((totalSolved / 1) * 100, 100),
          },
          {
            icon: "",
            title: "Problem Solver",
            description: "Solve 50 problems",
            unlocked: totalSolved >= 50,
            progress: Math.min((totalSolved / 50) * 100, 100),
          },
          {
            icon: "",
            title: "Code Master",
            description: "Solve 100 problems",
            unlocked: totalSolved >= 100,
            progress: Math.min((totalSolved / 100) * 100, 100),
          },
          {
            icon: "",
            title: "Blogger",
            description: "Write your first blog",
            unlocked: totalBlogs >= 1,
            progress: Math.min((totalBlogs / 1) * 100, 100),
          },
          {
            icon: "",
            title: "Content Creator",
            description: "Write 5 blogs",
            unlocked: totalBlogs >= 5,
            progress: Math.min((totalBlogs / 5) * 100, 100),
          },
          {
            icon: "",
            title: "Consistency King",
            description: "Maintain a 7-day streak",
            unlocked: currentStreak >= 7,
            progress: Math.min((currentStreak / 7) * 100, 100),
          },
          {
            icon: "",
            title: "Dedicated Learner",
            description: "Maintain a 30-day streak",
            unlocked: currentStreak >= 30,
            progress: Math.min((currentStreak / 30) * 100, 100),
          },
          {
            icon: "",
            title: "Community Star",
            description: "Get 10 blog likes",
            unlocked: blogLikes >= 10,
            progress: Math.min((blogLikes / 10) * 100, 100),
          },
        ];
      }
      // Switch between public and private blogs
      function switchBlogTab(tab) {
        currentBlogTab = tab;
        document
          .querySelectorAll(".tab")
          .forEach((t) => t.classList.remove("active"));
        event.target.classList.add("active");
        renderBlogs();
      }

      // Render blogs
      function renderBlogs() {
        const container = document.getElementById("blogsContent");
        if (!currentUserData) return;

        const blogs = currentUserData.blogs?.recentBlogs || [];
        const filteredBlogs =
          currentBlogTab === "public"
            ? blogs.filter((blog) => blog.isPublic)
            : blogs.filter((blog) => !blog.isPublic);

        if (filteredBlogs.length === 0) {
          const message =
            currentBlogTab === "public"
              ? "No public blogs yet. Share your knowledge!"
              : "No private blogs yet. Start writing!";
          container.innerHTML = `<div class="empty-state">${message}</div>`;
          return;
        }

        container.innerHTML = filteredBlogs
          .map(
            (blog) => `
                <div class="content-item blog-item">
                    <div class="blog-info">
                        <div class="blog-title">${escapeHtml(blog.title)}</div>
                        <div class="blog-date">${formatRelativeTime(
                          blog.createdAt
                        )}  ${blog.views || 0} views  ${
              blog.likes || 0
            } likes</div>
                    </div>
                    <a href="/blogs/${blog.slug}" class="blog-link">Read </a>
                </div>
            `
          )
          .join("");
      }

      // Render consistency map (heatmap)
      function renderConsistencyMap() {
        const heatmapGrid = document.getElementById("heatmapGrid");
        const monthsRow = document.getElementById("heatmapMonths");

        if (!currentUserData) return;

        const heatmapData = currentUserData.activity?.heatmapData || {};
        renderHeatmap(heatmapData, heatmapGrid, monthsRow);
      }

      // Heatmap rendering function (similar to index.html)
      function renderHeatmap(activityData, heatmapGrid, monthsRow) {
        heatmapGrid.innerHTML = "";
        monthsRow.innerHTML = "";

        const startDate = new Date("2025-09-25");
        const today = new Date();

        // Generate month labels
        const monthLabels = generateMonthLabels(startDate, today);
        monthLabels.forEach((month) => {
          const monthLabel = document.createElement("div");
          monthLabel.className = "month-label";
          monthLabel.textContent = month;
          monthsRow.appendChild(monthLabel);
        });

        // Generate heatmap cells
        let currentDate = new Date(startDate);
        const cells = [];

        for (let week = 0; week < 52; week++) {
          for (let day = 0; day < 7; day++) {
            const dateKey = formatDateKey(currentDate);
            const activityCount = activityData[dateKey] || 0;
            const activityLevel = getActivityLevel(activityCount);

            const cell = document.createElement("div");
            cell.className = `heatmap-cell level-${activityLevel}`;
            cell.setAttribute(
              "title",
              `${formatDisplayDate(
                currentDate
              )}: ${activityCount} problems solved`
            );
            cells.push(cell);

            currentDate.setDate(currentDate.getDate() + 1);
            if (currentDate > today) break;
          }
          if (currentDate > today) break;
        }

        cells.forEach((cell) => {
          heatmapGrid.appendChild(cell);
        });
      }

      // Helper functions for heatmap
      function formatDateKey(date) {
        return date.toISOString().split("T")[0];
      }

      function formatDisplayDate(date) {
        return date.toLocaleDateString("en-US", {
          weekday: "short",
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      function getActivityLevel(count) {
        if (count === 0) return 0;
        if (count === 1) return 1;
        if (count === 2) return 2;
        if (count === 3) return 3;
        return 4;
      }

      function generateMonthLabels(startDate, endDate) {
        const labels = [];
        const currentDate = new Date(startDate);
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];

        while (currentDate <= endDate) {
          if (
            currentDate.getDate() <= 7 ||
            currentDate.getTime() === startDate.getTime()
          ) {
            labels.push(months[currentDate.getMonth()]);
          } else {
            labels.push("");
          }
          currentDate.setDate(currentDate.getDate() + 7);
        }

        return labels.slice(0, 52);
      }

      // Render progress bars
      function renderProgressBars() {
        const container = document.getElementById("progressBars");
        if (!currentUserData) return;

        const user = currentUserData;
        const totalSolved = user.statistics?.totalProblemsSolved || 0;
        const totalBlogs = user.statistics?.totalBlogsPublished || 0;
        const blogLikes = user.statistics?.totalBlogLikes || 0;
        const blogViews = user.statistics?.totalBlogViews || 0;

        container.innerHTML = `
                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">Problems Solved</span>
                        <span class="progress-value">${totalSolved}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(
                          (totalSolved / 100) * 100,
                          100
                        )}%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">Blogs Published</span>
                        <span class="progress-value">${totalBlogs}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(
                          (totalBlogs / 10) * 100,
                          100
                        )}%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">Blog Engagement</span>
                        <span class="progress-value">${blogLikes} likes</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(
                          (blogLikes / 50) * 100,
                          100
                        )}%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-label">Knowledge Shared</span>
                        <span class="progress-value">${blogViews} views</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(
                          (blogViews / 100) * 100,
                          100
                        )}%"></div>
                    </div>
                </div>
            `;
      }

      // Load user directory - all users except current user
      async function loadUserDirectory() {
        const container = document.getElementById("userDirectory");
        const currentUsername = currentUserData?.username;

        if (!currentUsername) {
          container.innerHTML =
            '<div class="empty-state">Please log in to see the community</div>';
          return;
        }

        try {
          const token = localStorage.getItem("authToken");
          const response = await fetch(`${API_BASE_URL}/users`, {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to load users");
          }

          const result = await response.json();

          if (result.success && result.users) {
            // Filter out current user and render others
            const otherUsers = result.users.filter(
              (user) => user.username !== currentUsername
            );
            renderUserDirectory(otherUsers, container);
          } else {
            throw new Error(result.error || "No users found");
          }
        } catch (error) {
          console.error("Error loading user directory:", error);
          // Fallback: Show message about community feature
          container.innerHTML = `
            <div class="empty-state">
                Community feature coming soon! 
                <br><small>Other users will appear here as they join.</small>
            </div>
        `;
        }
      }

      // Render user directory
      function renderUserDirectory(users, container) {
        if (!users || users.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
                No other users yet 
                <br><small>Be the first to invite friends to join!</small>
            </div>
        `;
          return;
        }

        container.innerHTML = users
          .map(
            (user) => `
        <div class="user-item" onclick="viewUserProfile('${user.username}')">
            <div class="user-avatar">${generateUserAvatar(user.username)}</div>
            <div class="user-details">
                <div class="user-name">${escapeHtml(user.username)}</div>
                <div class="user-stats">
                    <span class="user-stat">${
                      user.totalSolved || 0
                    } solved</span>
                    <span class="user-stat">${user.totalBlogs || 0} blogs</span>
                    <span class="user-stat">${
                      user.currentStreak || 0
                    } day streak</span>
                </div>
            </div>
            <div class="user-action">View Profile </div>
        </div>
    `
          )
          .join("");
      }

      // Generate consistent avatar for any user

      // Enhanced avatar system - unique, thematic, and expressive
      function generateUserAvatar(username) {
        // Theme-based avatar collections
        const codingThemed = [
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
        ];

        const natureThemed = [
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
        ];

        const animalThemed = [
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
        ];

        const creativeThemed = [
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
        ];

        const wisdomThemed = [
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
        ];

        // Combine all themes
        const allAvatars = [
          ...codingThemed,
          ...natureThemed,
          ...animalThemed,
          ...creativeThemed,
          ...wisdomThemed,
        ];

        // Generate consistent hash from username
        const hash = username.split("").reduce((a, b) => {
          a = (a << 5) - a + b.charCodeAt(0);
          return a & a;
        }, 0);

        // Select avatar based on hash
        const avatarIndex = Math.abs(hash) % allAvatars.length;

        return allAvatars[avatarIndex];
      }

      // Enhanced pixel avatar generation for profile header
      function generatePixelAvatar(username) {
        // Specialized collection for larger profile avatars
        const profileAvatars = [
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
          "",
        ];

        const hash = username.split("").reduce((a, b) => {
          a = (a << 5) - a + b.charCodeAt(0);
          return a & a;
        }, 0);

        const avatarIndex = Math.abs(hash) % profileAvatars.length;
        return profileAvatars[avatarIndex];
      }
      // View user profile - opens in new page
      function viewUserProfile(username) {
        // Navigate to profile page with user parameter
        window.location.href = `/user-profile.html?user=${encodeURIComponent(
          username
        )}`;
      }

      // Utility function to escape HTML
      function escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      // Initialize profile when page loads
      document.addEventListener("DOMContentLoaded", function () {
        const token = localStorage.getItem("authToken");
        if (!token) {
          window.location.href = "/index.html";
          return;
        }
        loadUserProfile();
      });

      // Add responsive behavior for the heatmap
      window.addEventListener("resize", function () {
        if (currentUserData) {
          renderConsistencyMap();
        }
      });
    </script>
  </body>
</html>
